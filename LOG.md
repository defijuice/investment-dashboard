# 작업 로그

## 2025-12-20: 프로젝트 초기화 및 로그 시스템 구축

### 1. LOG.md 파일 생성

**사용자 명령:**
```
/log
```

**Claude Code 작업 흐름:**

1. **프로젝트 구조 분석**
   - LOG.md 파일 존재 여부 확인 → 파일 없음
   - 프로젝트 구조 파악: KVIC 공지사항 자동화 프로젝트
   - 주요 기술 스택: Node.js, Puppeteer, Google APIs

2. **LOG.md 생성**
   - 프로젝트 루트에 LOG.md 파일 생성 ✅
   - 날짜별 섹션 형식 적용

**생성된 파일:**
- `LOG.md` - 작업 로그 파일

---

### 2. 에어테이블 출자사업 테이블 셋팅

**사용자 명령:**
```
출자사업_테이블구조.md 참고해서 에어테이블 셋팅해줘.
```

**Claude Code 작업 흐름:**

1. **테이블 구조 분석**
   - `출자사업_테이블구조.md` 파일 확인
   - 3개 테이블 정의: 운용사, 출자사업, 신청현황
   - 테이블 간 관계: 신청현황 → 운용사(복수), 신청현황 → 출자사업(단일)

2. **API 설정 방식 결정**
   - 사용자에게 설정 방식 질문 → "API로 자동 생성" 선택
   - .env 파일에서 API 키와 Base ID 확인 필요

3. **환경변수 확인 과정**
   - 시스템 환경변수 확인 → Base ID 없음 ❌
   - .env 파일 확인 → API_KEY, BASE_ID 모두 존재 ✅
   - 주의: 시스템 환경변수와 .env 파일의 API 키가 다름

4. **스크립트 작성 (1차 시도)**
   - `src/setup-airtable.js` 생성
   - CommonJS `require('dotenv')` 사용
   - → 실행 오류: ES 모듈 환경에서 require 사용 불가 ❌

5. **스크립트 수정 (2차 시도)**
   - ES 모듈 형식으로 변경 (`import dotenv from 'dotenv'`)
   - → 실행 오류: "INVALID_PERMISSIONS_OR_MODEL_NOT_FOUND" ❌
   - → 원인: 시스템 환경변수가 .env보다 우선 적용됨

6. **dotenv 설정 수정 (3차 시도)**
   - `config({ path: '...', override: true })` 옵션 추가
   - → 운용사, 출자사업 테이블 생성 성공 ✅
   - → 신청현황 테이블 오류: `prefersSingleRecordLink` 옵션 문제 ❌

7. **신청현황 테이블 링크 필드 수정 (4차 시도)**
   - `prefersSingleRecordLink` 옵션 제거
   - → 오류: `brownLight2` 색상값 유효하지 않음 ❌

8. **색상값 수정 (5차 시도)**
   - `brownLight2` → `redLight1`로 변경
   - → 오류: Primary field에 링크 타입 사용 불가 ❌

9. **Primary field 추가 (6차 시도)**
   - 신청현황 테이블 첫 번째 필드로 `ID` (singleLineText) 추가
   - → 모든 테이블 생성 성공 ✅

**최종 결과:**

| 테이블 | ID | 필드 |
|--------|-----|------|
| 운용사 | tblKMpsKNU5vBjYNY | 운용사명, 영문명, 유형, 국가 |
| 출자사업 | tbl68hKHtVHwtmHFR | 사업명, 소관, 공고유형, 연도, 차수 |
| 신청현황 | tblig4a6HD3VPvgId | ID, 출자사업(링크), 출자분야, 운용사(링크-복수), 결성예정액, 출자요청액, 최소결성규모, 통화단위, 상태, 접수발표일, 선정발표일 |

**생성/수정된 파일:**
- `src/setup-airtable.js` - 에어테이블 테이블 생성 스크립트

**배운 점:**
- Airtable API에서 `prefersSingleRecordLink`는 테이블 생성 시 지원되지 않음
- Primary field는 링크 타입이 될 수 없음 (text 타입 필요)
- dotenv의 `override: true` 옵션으로 시스템 환경변수 덮어쓰기 가능
- 유효한 Airtable 색상값: blueLight2, greenLight2, yellowLight2 등 (brownLight2는 무효)

---

### 3. 해외VC 글로벌 펀드 선정결과 에어테이블 업데이트

**사용자 명령:**
```
downloads에 있는 파일 중 4524로 시작하는 것 하나를 읽고 출자사업_테이블구조.md 파일 참고해서 에어테이블에 값을 업데이트 해줘
```

**Claude Code 작업 흐름:**

1. **PDF 파일 탐색**
   - `~/Downloads/4524*` 검색 → 파일 없음 ❌
   - → 사용자 피드백: "작업 폴더 하위 downloads 폴더!"
   - `./downloads/4524*` 검색 → `4524_2025년_해외VC_글로벌_펀드_출자사업_최종_선정결과.pdf` 발견 ✅

2. **PDF 내용 파싱**
   - PDF 읽기 → 2025년 해외VC 글로벌 펀드 출자사업 최종 선정결과
   - 일반분야 10개 운용사 + AI·Secondary·Climate Tech 분야 3개 운용사 = 총 13개

3. **출자사업 레코드 생성**
   - "해외VC 글로벌 펀드 2025년" 레코드 생성 ✅
   - ID: `recaxRwOLxzAl2dVK`

4. **운용사 레코드 생성 (1차 시도)**
   - 13개 운용사 일괄 생성
   - → 성공했으나 **중복 발생** ❌
   - → 사용자 피드백: "운용사 생성할 때 이미 있으면 안해야지? 중복되지 않아?"

5. **중복 레코드 정리**
   - 전체 운용사 조회 → 23개 레코드 (10개 중복)
   - 중복 레코드 식별 및 삭제 ✅
   - 최종 13개 운용사 유지

6. **신청현황 레코드 생성 (1차 시도)**
   - 기존 통화단위 옵션: 억원, USD M, EUR M
   - GBP M, JPY M 옵션 필요 → 레코드 생성 실패 ❌
   - → 에러: "Insufficient permissions to create new select option"

7. **필드 옵션 업데이트 시도**
   - Meta API로 통화단위 필드 업데이트 시도 → 실패 ❌
   - → 에러: "Invalid request: parameter validation failed"

8. **USD M, EUR M 레코드 먼저 생성**
   - 기존 옵션으로 가능한 11건 먼저 생성 ✅
   - GBP M (Crane Venture Partners), JPY M (DCI Partners) 2건 보류

9. **typecast 옵션 발견 (해결책)**
   - → 사용자 피드백: "옵션이 없다면 너가 직접 옵션생성하는 단계를 넣어서 실행해"
   - 웹 검색 → `typecast: true` 옵션 발견 ✅
   - typecast 사용 시 새로운 Single Select 옵션 자동 생성 가능

10. **나머지 2건 생성 (typecast 사용)**
    - GBP M, JPY M 옵션 자동 생성되며 레코드 생성 성공 ✅

**최종 결과:**

| 테이블 | 생성 레코드 |
|--------|------------|
| 출자사업 | 1건 (해외VC 글로벌 펀드 2025년) |
| 운용사 | 13개 (중복 10개 삭제 후) |
| 신청현황 | 13건 (모두 선정 상태) |

**생성된 운용사:**
- 미국: Nyca Partners, Hustle Fund, Strong Ventures, Sazze Partners, Top Tier Capital Partners, AP Ventures
- 유럽/중동: Crane Venture Partners, Korelya Capital, Jolt Capital
- 아시아: TNB Aura, Alpha JWC, DCI Partners, AppWorks Ventures

**배운 점:**
- `typecast: true` 옵션으로 존재하지 않는 Single Select 옵션 자동 생성 가능
- 운용사 등 마스터 데이터는 생성 전 중복 체크 필수
- Meta API로 필드 옵션 수정은 제한적 (typecast가 더 실용적)

---

### 4. /update 커스텀 커맨드 생성

**사용자 명령:**
```
방금까지 했던 과정을 커스텀커맨드로 만들고 싶어
입력파라미터는 파일번호
실행명령어는 update
```

**Claude Code 작업 흐름:**

1. **기존 커맨드 구조 확인**
   - `.claude/commands/` 폴더 확인
   - 기존 커맨드: `commit.md`, `log.md`

2. **update.md 커맨드 작성**
   - 입력 파라미터: `$ARGUMENTS` (파일번호)
   - 주요 기능:
     - PDF 파일 읽기 및 파싱
     - 중복 체크 후 운용사/출자사업 생성
     - `typecast: true`로 새 옵션 자동 생성
     - 신청현황 레코드 생성

**생성된 파일:**
- `.claude/commands/update.md` - 출자사업 선정결과 업데이트 커맨드

**사용법:**
```
/update 4524
```

---

### 5. 파일처리이력 테이블 추가

**사용자 명령:**
```
근데 내가 처리한 파일인지 여부를 알 수 없는데 파일에 대한 DB도 에어테이블에 넣어야겠다.
신청현황테이블과 link 되어야겠고. 그리고 처리상태도 관리해야겠어.
그래서 처리되면 처리상태 바뀌게끔 하는 게 필요해. 어떻게 하면 좋을까
```

**Claude Code 작업 흐름:**

1. **요구사항 분석**
   - 사용자 니즈 파악: 파일 처리 여부 추적 필요
   - 중복 처리 방지 + 처리 이력 관리
   - 신청현황 테이블과 연결하여 역추적 가능하게

2. **테이블 설계 제안**
   - 파일처리이력 테이블 구조 설계
   - 필드: 파일명, 파일번호, 처리상태(대기/처리중/완료/오류), 처리일시, 신청현황(링크), 비고
   - → 사용자에게 3가지 옵션 제안 (기본/간단/상세)
   - → "위 제안대로 진행" 선택 ✅

3. **테이블 생성 스크립트 작성**
   - `src/setup-file-history.js` 생성
   - 기존 setup-airtable.js 패턴 참고
   - 신청현황 테이블 ID 조회 후 링크 필드 연결

4. **테이블 생성 실행**
   - 스크립트 실행 → 성공 ✅
   - 테이블 ID: `tbl92nQx3b0V1WNdu`

5. **문서 업데이트**
   - `출자사업_테이블구조.md`에 테이블 4: 파일처리이력 섹션 추가
   - `.claude/commands/update.md`에 파일 이력 체크 로직 추가
     - 0단계: 파일 처리 이력 확인 (중복 방지)
     - 6단계: 처리 완료 후 이력 업데이트

**최종 결과:**

| 테이블 | ID | 설명 |
|--------|-----|------|
| 파일처리이력 | tbl92nQx3b0V1WNdu | PDF 파일 처리 이력 관리 |

**워크플로우:**
```
/update 4524 실행
    ↓
파일처리이력에서 "4524" 조회
    ├─ "완료" 상태 → "재처리하시겠습니까?" 확인
    ├─ "처리중" 상태 → 중단
    └─ 없음 → 진행
    ↓
상태 "처리중"으로 업데이트
    ↓
PDF 처리 및 레코드 생성
    ↓
성공: 상태 "완료" + 신청현황 링크
실패: 상태 "오류" + 에러 메시지
```

**생성/수정된 파일:**
- `src/setup-file-history.js` - 파일처리이력 테이블 생성 스크립트
- `출자사업_테이블구조.md` - 테이블 4 섹션 추가
- `.claude/commands/update.md` - 파일 이력 체크 로직 추가

---

### 6. KVIC 공지사항 첨부파일 자동화 실행

**사용자 명령:**
```
https://www.kvic.or.kr/notice/kvic-notice/investment-business-notice 여기에서 [접수현황] 또는 [선정결과] 카테고리의 게시글 눌러서 첨부파일을 모두 다운로드 받아서 구글드라이브 이곳에 업로드하는 자동화를 하고 싶어.
https://drive.google.com/drive/u/0/folders/1OhnHUj9I11kQYaBN6j-K9xUWOxiak1ni
```

**Claude Code 작업 흐름:**

1. **기존 코드 분석**
   - 프로젝트에 이미 완성된 자동화 코드 존재 확인 ✅
   - `src/index.js`, `src/scraper.js`, `src/googleDrive.js`
   - Puppeteer + Google Drive API 조합

2. **환경 설정 확인**
   - `.env` 파일 확인 → `GOOGLE_DRIVE_FOLDER_ID` 이미 설정됨 ✅
   - OAuth 방식 vs Service Account 방식 질문 → OAuth 선택

3. **OAuth 설정**
   - 사용자에게 Google Cloud Console OAuth 클라이언트 ID 생성 안내
   - `credentials/oauth-credentials.json` 파일 생성 확인 ✅

4. **스크립트 실행 (1차 시도)**
   - `npm start` 실행 → 포트 3000 충돌 ❌
   - → 에러: "EADDRINUSE: address already in use :::3000"

5. **포트 정리 후 재실행**
   - `lsof -ti:3000 | xargs kill -9` 실행
   - `npm start` 재실행 → 성공 ✅
   - Google OAuth 인증 완료 → 토큰 저장

6. **첫 번째 실행 결과**
   - 5페이지 스캔, 23개 게시글 발견
   - 모든 게시글이 이미 처리됨 (스킵)
   - → 이전에 실행된 기록이 `processed.json`에 있음

7. **2024년 데이터 요청**
   - 사용자 요청: "날짜가 2024년도인것부터 가져와줘"
   - `processed.json` 초기화 (notices: [])
   - `.env`에 `MAX_PAGES=30` 추가

8. **전체 스캔 실행**
   - 30페이지 스캔 (2023년 4월 ~ 2025년 12월)
   - 총 121개 첨부파일 다운로드 및 업로드 ✅
   - 처리 시간: 약 23분

**최종 결과:**

| 항목 | 값 |
|------|-----|
| 스캔 페이지 | 30페이지 |
| 처리된 게시글 | 121개 |
| 업로드된 파일 | 121개 |
| 대상 카테고리 | 접수현황, 선정결과 |

**주요 파일 예시:**
- 2024~2025년 정시/수시 출자사업 접수현황 및 선정결과
- 지역혁신 벤처펀드, 해외VC 글로벌 펀드 문서
- 모태펀드 각 계정별(문화, 영화, 특허, 보건, 해양 등) 출자사업 문서

**수정된 파일:**
- `.env` - `MAX_PAGES=30` 추가
- `processed.json` - 121개 게시글 ID 기록

**배운 점:**
- 기존 `processed.json`으로 중복 처리 방지
- `MAX_PAGES` 환경변수로 스캔 범위 조절 가능
- OAuth 토큰은 `credentials/token.json`에 저장되어 재사용

---

### 7. 구글 드라이브 파일 URL을 에어테이블 파일처리이력에 등록

**사용자 명령:**
```
근데 이미 구글드라이브에도 업로드 하고 있는데 굳이 로컬에 또 저장할 필요는 없을거같아
구글드라이브에 업로드하고 해당 파일 url을 에어테이블 파일처리이력 테이블에 '파일URL' 필드 하나 추가해서 거기에 업데이트 하는 걸로 하자.
우선 지금 저장한 전체 파일을 에어테이블에 그렇게 올려줘
```

**Claude Code 작업 흐름:**

1. **기존 코드 구조 파악**
   - `src/googleDrive.js` - Google Drive API 클래스
   - `src/setup-file-history.js` - 파일처리이력 테이블 생성 스크립트
   - 파일처리이력 테이블 ID: `tbl92nQx3b0V1WNdu`

2. **스크립트 작성 (1차 시도)**
   - `src/update-file-urls.js` 생성
   - 구글 드라이브 파일 목록 조회 → 에어테이블에 파일URL 필드 추가 → 레코드 업데이트
   - → 실행 결과: 드라이브 파일 100개만 조회됨 ❌
   - → 원인: Google Drive API 기본 페이지 크기가 100개

3. **페이지네이션 추가**
   - `googleDrive.js`의 `listFiles()` 함수 수정
   - `pageSize: 1000` + `nextPageToken` 처리 추가
   - → 전체 121개 파일 조회 성공 ✅

4. **파일URL 필드 추가 시도**
   - Meta API로 필드 추가 시도 → 실패 ❌
   - → 에러: "INVALID_PERMISSIONS_OR_MODEL_NOT_FOUND"
   - → 원인: API 키에 스키마 변경 권한 없음

5. **수동 필드 추가**
   - 사용자에게 Airtable UI에서 '파일URL' 필드(URL 타입) 직접 추가 요청
   - → 사용자가 필드 추가 완료 ✅

6. **환경변수 로딩 문제**
   - `dotenv/config` import 시 시스템 환경변수가 우선 적용됨 ❌
   - → 원인: 홈 디렉토리의 .env와 프로젝트 .env의 API 키가 다름
   - → 해결: `config({ path: ..., override: true })` 명시적 설정 ✅

7. **파일 레코드 생성**
   - 에어테이블에 레코드 없음 확인 → 새 레코드 생성 필요
   - 121개 파일 모두 새 레코드로 생성 ✅
   - 처리상태: '완료'로 설정

8. **처리상태 수정**
   - → 사용자 피드백: "처리현황은 실제로 파일 열어서 운용사, 출자사업, 신청현황 업데이트가 모두 완료된 후 완료처리 하는거야"
   - `src/fix-status.js` 스크립트 생성
   - 121개 레코드 모두 '완료' → '대기'로 변경 ✅
   - `update-file-urls.js`도 새 레코드 생성 시 '대기' 상태로 수정

**최종 결과:**

| 항목 | 값 |
|------|-----|
| 구글 드라이브 파일 | 121개 |
| 에어테이블 레코드 | 121개 |
| 처리상태 | 모두 '대기' |

**생성/수정된 파일:**
- `src/update-file-urls.js` - 구글 드라이브 파일 URL을 에어테이블에 등록
- `src/fix-status.js` - 처리상태 일괄 수정 스크립트
- `src/googleDrive.js` - `listFiles()` 페이지네이션 추가

**배운 점:**
- Google Drive API `files.list`는 기본 100개 제한 → `pageSize` + `nextPageToken` 필요
- Airtable Personal Access Token은 스키마 변경 권한이 제한적 (필드 추가 불가)
- dotenv의 `override: true`로 시스템 환경변수보다 .env 파일 우선 적용 가능

---

### 8. 선정결과 파일 수동 처리 (3개 완료)

**사용자 명령:**
```
선정결과 파일인줄은 너가 어떻게 알아?
지금은 그만할게. 앞으로 다시 내가 실행하려면 어떻게 해야햬?
```

**Claude Code 작업 흐름:**

1. **파일 유형 분류 현황 파악**
   - downloads 폴더 스캔: 121개 파일
   - PDF 118개, HWP 3개
   - 파일명에 "선정" 포함: 61개
   - 파일명에 "접수" 포함: 46개
   - 기타: 14개

2. **선정결과 파일 수동 처리 시작**
   - 4524는 이미 처리됨 → 제외
   - 3815부터 순서대로 처리 시작

3. **3815 처리 (지역혁신 벤처펀드 2022년)**
   - PDF 파싱 → 6개 운용사 (경남벤처투자, 라이트하우스컴바인인베스트 등)
   - 출자사업 생성: `recvoBwKUBHKh2MYk`
   - 운용사 7개 생성 (대덕벤처파트너스/에스케이증권 공동GP 포함)
   - 신청현황 6건 생성 ✅
   - 파일처리이력 업데이트: 완료 + 신청현황 링크 ✅

4. **3822 처리 (GEPS 글로벌 VC 펀드)**
   - PDF 파싱 → 4개 운용사 (Adams Street Partners, StepStone, TTCP, Northgate Capital)
   - 출자사업 생성: `reccPrf4LhdNSooML`
   - 운용사 4개 생성 (해외VC)
   - 신청현황 4건 생성 ✅
   - 파일처리이력 업데이트: 완료 ✅

5. **3830 처리 (한국모태펀드 2023년 1차 정시 중기부 소관)**
   - PDF 파싱 → 10개 운용사
   - 출자사업 생성: `recwobCI4RoZnsFUI`
   - 운용사 조회 → 대덕벤처파트너스 이미 존재 확인 ✅
   - 신규 운용사 9개 생성 (에이치비인베스트먼트, 토니인베스트먼트 등)
   - 신청현황 10건 생성 ✅
   - 파일처리이력 업데이트: 완료 ✅

**최종 결과:**

| 파일번호 | 출자사업 | 운용사 | 신청현황 |
|---------|---------|-------|---------|
| 3815 | 지역혁신 벤처펀드 2022년 | 7개 생성 | 6건 |
| 3822 | GEPS 글로벌 VC 펀드 | 4개 생성 | 4건 |
| 3830 | 한국모태펀드(중기부) 2023년 1차 정시 | 9개 생성 | 10건 |

**처리 진행 상황:**
- ✅ 완료: 4개 (3815, 3822, 3830, 4524)
- ⏳ 대기: 57개 (선정결과)
- ➖ 접수현황 등: 60개

---

### 9. 파일유형 필드 추가 및 자동 분류

**사용자 명령:**
```
선정결과 파일인줄은 너가 어떻게 알아?
옵션1로 하자 (파일처리이력에 "파일유형" 필드 추가)
```

**Claude Code 작업 흐름:**

1. **파일유형 필드 추가**
   - 사용자가 에어테이블 UI에서 '파일유형' 필드 추가 (Single Select)
   - 옵션: 선정결과, 접수현황, 기타

2. **121개 레코드 일괄 분류**
   - 파일명에 "선정" 포함 → 선정결과: 61개
   - 파일명에 "접수" 포함 → 접수현황: 46개
   - 기타: 14개

3. **일괄 업데이트 실행**
   - 선정결과 61개 업데이트 (10개씩 배치) ✅
   - 접수현황 46개 업데이트 ✅

4. **기타 14개 파일 상세 분류**
   - → 사용자 피드백: "신청_현황도 접수현황이야"
   - → 사용자 피드백: "심사_결과는 선정결과, 추진현황은 접수현황"
   - → 사용자 피드백: "심의결과도 선정결과"

   | 키워드 | 파일유형 |
   |-------|---------|
   | 선정, 심사_결과, 심의결과 | 선정결과 |
   | 접수, 신청_현황, 추진현황 | 접수현황 |

   - 신청_현황 10개 → 접수현황 ✅
   - 심사_결과 2개 → 선정결과 ✅
   - 심의결과 1개 → 선정결과 ✅
   - 추진현황 1개 → 접수현황 ✅

5. **기타 옵션 오류**
   - '기타' 옵션으로 업데이트 시도 → 실패 ❌
   - → 에러: "Insufficient permissions to create new select option"
   - → 사용자가 '기타' 옵션 에어테이블에 추가 ✅

**최종 결과:**

| 파일유형 | 개수 |
|---------|-----|
| 선정결과 | 64개 |
| 접수현황 | 57개 |

---

### 10. 파일유형 자동 분류 로직 추가

**사용자 명령:**
```
앞으로 파일 추가될 때 파일유형도 업데이트하는 로직도 추가해줘. 방금 너가 마주한 예외사항들도 각각 유형 잘 구분되게
없으면 null 말고 '기타'로 하자
```

**Claude Code 작업 흐름:**

1. **`src/update-file-urls.js` 수정**
   - `classifyFileType()` 함수 추가
   - 선정결과 키워드: 선정, 심사_결과, 심의결과
   - 접수현황 키워드: 접수, 신청_현황, 추진현황
   - 기본값: '기타'

2. **레코드 생성 시 파일유형 자동 설정**
   - `createRecord()` 함수에 파일유형 필드 추가

**수정된 파일:**
- `src/update-file-urls.js` - `classifyFileType()` 함수 추가

**분류 로직:**
```javascript
function classifyFileType(fileName) {
  if (fileName.includes('선정') ||
      fileName.includes('심사_결과') ||
      fileName.includes('심의결과')) {
    return '선정결과';
  }
  if (fileName.includes('접수') ||
      fileName.includes('신청_현황') ||
      fileName.includes('추진현황')) {
    return '접수현황';
  }
  return '기타';
}
```

---

### 11. 접수현황 + 선정결과 동시 처리 스크립트 개발

**사용자 명령:**
```
접수현황 파일을 처리하고 싶어. 근데 같은 사업이면 거의 대부분 접수현황과 선정결과 파일이 각각 존재해...
선정/접수 동시 매칭 처리로 해줘
```

**Claude Code 작업 흐름:**

1. **요구사항 분석**
   - 접수현황 PDF: 신청한 모든 운용사 목록
   - 선정결과 PDF: 최종 선정된 운용사 목록
   - 동시 처리 시: 접수에 있고 선정에 있으면 "선정", 없으면 "탈락"
   - 이미 DB에 "선정"으로 등록된 건은 유지

2. **스크립트 작성**
   - `src/process-pair.js` 생성
   - 두 PDF 파일을 파라미터로 받아 동시 처리
   - 사용법: `node src/process-pair.js <접수파일번호> <선정파일번호>`

3. **PDF 파싱 함수 구현**
   - `parseApplicationPdf()`: 접수현황 PDF에서 운용사 목록 추출
   - `parseSelectionPdf()`: 선정결과 PDF에서 운용사 목록 추출
   - `pdftotext -layout` 명령어로 PDF 텍스트 추출

4. **약어 매칭 문제 발생**
   - → 문제: 선정결과에서 "AVP", "CMBI", "TEDCO" 같은 약어 사용
   - → 접수현황에서는 정식명칭 "Atlantic Vantage Point", "CMB International..." 사용
   - → 매칭 실패 ❌

5. **약어 매핑 방식 논의**
   - 옵션1: 첫 글자 기반 약어 추론
   - 옵션2: 하드코딩 약어 테이블
   - 옵션3: 약어매핑테이블 (DB 저장)
   - → 사용자 선택: "약어매핑테이블"

6. **DB 기반 약어 매핑 구현**
   - → 사용자 제안: "약어는 운용사 테이블의 '약어(있는경우)' 필드값에 발견할 때마다 넣고 앞으로도 그 값을 참고하는 게 좋겠어"
   - 운용사 테이블에 '약어(있는경우)' 필드 추가 (사용자가 UI에서 생성)
   - `loadAliasMap()`: 시작 시 DB에서 약어 매핑 로드
   - `expandAlias()`: 약어를 정식명으로 변환
   - `updateOperatorAlias()`: 새 약어 발견 시 DB에 저장

7. **초기 약어 시드 스크립트**
   - `src/seed-aliases.js` 생성
   - 기존 알려진 약어 15개를 DB에 저장
   - AVP, CMBI, TEDCO, DV Partners, TNB Aura, Alpha JWC 등

8. **필드명 오류 (1차)**
   - → 오류: `UNKNOWN_FIELD_NAME: "약어"` ❌
   - → 원인: 사용자가 "약어(있는경우)"로 필드 생성함
   - → 해결: `ALIAS_FIELD = '약어(있는경우)'`로 수정 ✅

9. **PDF 파싱 오류 (지역명 감지 문제)**
   - → 문제: "유럽/중동 AVP EUR 157.25 8.48" 행에서 "유럽/중동" 감지 후 `continue`
   - → 결과: 해당 행의 데이터(AVP)가 파싱되지 않음 ❌
   - → 해결: 통화(USD/EUR/GBP/JPY) 포함 여부 체크 추가
   ```javascript
   if (line.match(/유럽/) && !line.match(/(USD|EUR|GBP|JPY)/)) {
     currentRegion = '유럽/중동';
     continue;
   }
   ```
   - 지역명이 테이블 행에 포함된 경우 별도 처리 ✅

10. **선정 6개 중 5개만 매칭 문제**
    - → 사용자 피드백: "선정 6개 중 5개만 매칭하면 어떡해"
    - → 원인 분석: 현재 로직은 "접수현황에 있는 운용사"만 처리
    - → 선정결과에만 있고 접수현황 파싱에서 누락된 운용사 처리 안됨

11. **[5-2] 단계 추가 (누락된 선정 운용사 처리)**
    - 접수현황 처리 시 매칭된 선정 운용사를 `processedSelectedNames`에 기록
    - 모든 접수현황 처리 후, 선정결과 목록 재순회
    - 아직 처리되지 않은 선정 운용사 발견 시:
      1. 약어 매핑으로 기존 운용사 찾기
      2. DB 부분 검색으로 매칭
      3. 없으면 새 운용사 생성
      4. "선정" 상태로 신청현황 레코드 생성
    - → 선정결과 6개면 6개 모두 반드시 처리됨 ✅

**최종 로직:**

```
[1] PDF 파싱
    ↓
[2] 약어 매핑 로드 (DB)
    ↓
[3] 출자사업 조회/생성
    ↓
[4] 기존 데이터 확인
    ↓
[5] 신청현황 생성 (접수현황 기준)
    - 선정결과에 있으면 → "선정"
    - 선정결과에 없으면 → "탈락"
    - 처리된 선정 운용사 추적
    ↓
[5-2] 누락된 선정 운용사 확인 ← 신규 추가
    - 선정결과에만 있는 운용사 처리
    - 약어 매핑 또는 DB 검색으로 운용사 찾기
    - "선정" 상태로 등록
    ↓
[6] 새 약어 저장 (DB)
    ↓
[7] 파일처리이력 업데이트
```

**생성/수정된 파일:**
- `src/process-pair.js` - 접수+선정 동시 처리 메인 스크립트
- `src/seed-aliases.js` - 초기 약어 시드 스크립트

**사용법:**
```bash
node src/process-pair.js 4461 4524
# 4461: 접수현황 파일번호
# 4524: 선정결과 파일번호
```

**배운 점:**
- PDF 테이블 파싱 시 지역명이 데이터 행에 포함될 수 있음 → 통화 패턴으로 구분
- 약어 매핑은 DB에 저장하여 자동 학습되도록 설계
- 선정결과 기준 "완전성" 검증 필수 → 모든 선정자가 반드시 처리되어야 함

---

### 12. 국내 모태펀드 선정결과 파싱 기능 추가

**사용자 명령:**
```
근데 결성예정액 출자요청액 최소결성규모 등 값은 왜 다 비었어?
```

**Claude Code 작업 흐름:**

1. **문제 원인 분석**
   - Airtable 신청현황 조회 → 해외VC 선정은 금액 정상 저장됨 ✅
   - 국내 사업 데이터 확인 → 금액 필드 비어있음 ❌
   - PDF 구조 비교:
     - 접수현황 PDF: **분야별 합계**만 있고 개별 운용사 금액 없음
     - 선정결과 PDF: 개별 운용사별 금액 있음 (최소결성규모, 모태출자액)
   - → **국내 선정결과 파싱 로직 누락** 확인

2. **PDF 형식 분석**
   - 해외VC 형식: `운용사명 통화 최소결성규모 출자액` (USD/EUR/GBP/JPY 포함)
   - 국내 형식: `숫자 숫자 운용사명` (억원 단위, 통화 표시 없음)
   - 카테고리가 **데이터 행 뒤에** 나오는 경우 있음 (복잡한 테이블 구조)

3. **국내 파싱 함수 작성 (1차 시도)**
   - `parseDomesticSelectionPdf()` 함수 추가
   - 카테고리 순차 감지 방식 → 첫 번째 운용사 카테고리 비어있음 ❌
   - → 원인: 카테고리가 데이터 행 뒤에 나와서 순차 감지 실패

4. **2-패스 파싱 로직으로 수정 (2차 시도)**
   - 1단계: 모든 데이터 행과 카테고리 위치 수집
   - 2단계: 각 데이터 행에 가장 가까운 카테고리 할당
   - → 파싱 결과 17개 운용사 정상 추출 ✅
   - → 카테고리 정확히 매칭됨 ✅

5. **사용자 피드백: PDF 형식 다양성 문제**
   - → "이렇게 표가 다 파일마다 다른데 AI 에이전트로 직접 읽고 판단하는 걸 추가하면 안돼?"
   - → 좋은 지적! 규칙 기반 파싱의 한계 인정

6. **AI 기반 파싱 함수 추가**
   - `@anthropic-ai/sdk` 패키지 설치
   - `parseSelectionPdfWithAI()`, `parseApplicationPdfWithAI()` 함수 추가
   - Claude API로 PDF 텍스트 분석 → JSON 구조화 데이터 반환
   - → API 키 필요 문제 발생 ❌

7. **사용자 피드백: Claude Code 활용**
   - → "클로드코드 쓰면 별도 API 필요없잖아"
   - → 맞음! Claude Code 내에서 직접 PDF 읽고 파싱하면 됨
   - 두 가지 방식 제안:
     1. 수동 방식: `/update` 실행 시 Claude Code가 직접 파싱
     2. 스크립트 방식: PDF 텍스트 저장 → Claude Code 파싱 → JSON 결과 활용

**생성/수정된 파일:**
- `src/process-pair.js` - `parseDomesticSelectionPdf()` 함수 추가, AI 파싱 함수 추가
- `package.json` - `@anthropic-ai/sdk` 의존성 추가

**배운 점:**
- 국내 모태펀드 PDF는 해외VC PDF와 형식이 다름 (통화 표시 없음, 카테고리 위치 불규칙)
- 복잡한 테이블은 2-패스 파싱이 효과적 (위치 수집 → 매핑)
- PDF 형식이 너무 다양할 때는 AI 기반 파싱이 더 유연함
- Claude Code 내에서 직접 파싱하면 별도 API 키 불필요

---

### 13. 지역혁신 벤처펀드 2022년 선정결과 처리 (3815)

**사용자 명령:**
```
3815 파일과 맵핑되는 접수현황 파일을 처리해줄래?
```

**Claude Code 작업 흐름:**

1. **파일 확인**
   - 3815 파일: `지역혁신벤처펀드_2022년_출자사업_선정결과_게시용_.pdf`
   - 매핑되는 접수현황 파일 검색 → 없음 (선정결과만 존재)

2. **PDF 내용 파싱**
   - 선정 조합 6개, 결성예정액 1,136억원, 출자요청액 774억원
   - 3개 분야: 동남권, 대구·제주·광주, 전북·강원 지역혁신

3. **표 병합 형식 질문**
   - 분야별 합계만 있고 개별 금액 없음
   - → 사용자 피드백: "각각 같은 금액이 들어가야해. 균등배분이 아니라 각각 동일금액"
   - → 이해: 표 병합 = 같은 분야 내 모든 운용사가 동일한 결성예정액/출자요청액

4. **데이터 정리**
   | 운용사 | 출자분야 | 결성예정액 | 출자요청액 |
   |--------|---------|-----------|-----------|
   | 경남벤처투자 | 동남권 지역혁신 | 400억 | 280억 |
   | 라이트하우스컴바인인베스트 | 동남권 지역혁신 | 400억 | 280억 |
   | 넥스트지인베스트먼트 | 대구·제주·광주 지역혁신 | 426억 | 298억 |
   | 대덕벤처파트너스 | 대구·제주·광주 지역혁신 | 426억 | 298억 |
   | 에스케이증권 | 대구·제주·광주 지역혁신 | 426억 | 298억 |
   | 소풍벤처스 | 전북·강원 지역혁신 | 310억 | 196억 |
   | 안다아시아벤처스 | 전북·강원 지역혁신 | 310억 | 196억 |

5. **Airtable 저장 실행**
   - 출자사업: `지역혁신 벤처펀드 2022년` (기존 레코드 사용)
   - 운용사 7개 조회/생성
   - 신청현황 7건 생성 (모두 선정 상태) ✅

**최종 결과:**

| 항목 | 값 |
|------|-----|
| 출자사업 | 지역혁신 벤처펀드 2022년 |
| 신청현황 | 7건 (모두 선정) |
| 통화단위 | 억원 |

**배운 점:**
- 표 병합 형식: 분야별 합계가 아니라 **각 운용사에 동일 금액 적용**
- 공동GP (대덕벤처파트너스/에스케이증권)는 별도 운용사로 분리

---

### 14. Airtable → Google Sheets DB 마이그레이션

**사용자 명령:**
```
DB를 에어테이블에서 구글시트로 옮겨야겠어. 에어테이블에 쌓기에 데이터가 너무 많네..
https://docs.google.com/spreadsheets/d/1UdCCcjwRf51k8xe81545rQ2VlmJkO5wDxg0SyCgfK2s/edit?gid=0#gid=0
여기로 DB 구조를 넘어가려고 하는데 가독성도 좋고 관리도 편한 방법을 계획해줘
```

**Claude Code 작업 흐름:**

1. **현재 에어테이블 구조 분석**
   - 4개 테이블 확인: 운용사, 출자사업, 신청현황, 파일처리이력
   - 관계: 신청현황 → 운용사(복수, Link), 신청현황 → 출자사업(Link)
   - 파일처리이력 → 신청현황(Link)

2. **Google Sheets 설계 (1차 제안)**
   - 3개 시트: 신청현황(메인), 운용사(마스터), 출자사업(마스터)
   - 공동GP 처리: 운용사1, 운용사2, 운용사3 열 분리 방식
   - 파일처리이력: `processed.json` 로컬 관리로 이전
   - → 사용자 피드백 ❌

3. **사용자 피드백: ID 기반 참조 방식**
   - → "운용사1 운용사2 .. 이렇게 하는게 아니라 각 테이블의 uniqueId 값을 두고 그 값을 쉼표로 이어서 한 셀에 넣어야지"
   - → 각 테이블에 고유 ID 추가 (OP0001, PJ0001, AP0001)
   - → 운용사ID 필드에 쉼표로 연결 (예: "OP0001,OP0002")

4. **스크립트 작성 및 초기 마이그레이션**
   - `src/googleSheets.js`: Google Sheets API 클라이언트 (OAuth 재사용)
   - `src/setup-sheets.js`: 시트 초기화 (헤더, Data Validation)
   - `src/migrate-to-sheets.js`: Airtable → Sheets 데이터 이전
   - 실행 → 3개 시트(운용사, 출자사업, 신청현황) 마이그레이션 완료 ✅

5. **사용자 피드백: 파일처리이력 누락**
   - → "파일처리현황 테이블은 왜 없어?"
   - → 시트에서 제외했던 파일처리이력도 포함해야 함
   - 4개 테이블 모두 마이그레이션으로 변경 ✅

6. **구조 비교 및 필드 동기화**
   - Airtable API로 실제 필드명 조회
   - 누락 필드 발견: 파일처리이력에 `파일URL`, `파일유형` 없음 ❌
   - 추가 필드 확인: 시트에만 있는 `처리일시`, `비고`

7. **파일처리이력 필드 추가**
   - → 사용자 동의: "응"
   - 헤더 업데이트: `['ID', '파일명', '파일번호', '파일유형', '파일URL', '처리상태', '처리일시', '신청현황ID', '비고']`
   - 드롭다운 업데이트: D열(파일유형), F열(처리상태)

8. **최종 마이그레이션 실행**
   - `node src/setup-sheets.js` → 4개 시트 헤더/드롭다운 설정 ✅
   - `node src/migrate-to-sheets.js` → 전체 데이터 이전 ✅

**최종 결과:**

| 테이블 | 레코드 수 | ID 범위 |
|--------|----------|---------|
| 운용사 | 204개 | OP0001 ~ OP0204 |
| 출자사업 | 6개 | PJ0001 ~ PJ0006 |
| 신청현황 | 409개 | AP0001 ~ AP0409 |
| 파일처리이력 | 80개 | FH0001 ~ FH0080 |

**Google Sheets 구조 (최종):**

| 시트 | 헤더 |
|------|------|
| 운용사 | ID, 운용사명, 영문명, 유형, 국가, 약어 |
| 출자사업 | ID, 사업명, 소관, 공고유형, 연도, 차수 |
| 신청현황 | ID, 출자사업ID, 운용사ID, 출자분야, 결성예정액, 출자요청액, 최소결성규모, 통화단위, 상태, 접수발표일, 선정발표일, 비고 |
| 파일처리이력 | ID, 파일명, 파일번호, 파일유형, 파일URL, 처리상태, 처리일시, 신청현황ID, 비고 |

**관계 표현 방식:**
- Link 필드 → ID 참조 (텍스트)
- 복수 Link (공동GP) → 쉼표로 연결 (예: "OP0001,OP0002")

**생성/수정된 파일:**
- `src/googleSheets.js` - Google Sheets API 클라이언트
- `src/setup-sheets.js` - 시트 초기화 스크립트
- `src/migrate-to-sheets.js` - Airtable → Sheets 마이그레이션 스크립트
- `src/process-pair-sheets.js` - PDF 처리 (Sheets 버전)
- `.env` - `GOOGLE_SPREADSHEET_ID` 추가
- `CLAUDE.md` - 문서 업데이트

**배운 점:**
- Airtable Link 필드는 Google Sheets에서 ID 참조 + 쉼표 연결로 표현 가능
- 각 테이블에 고유 ID(prefix + 4자리 숫자) 부여하면 관계 추적 용이
- Data Validation으로 드롭다운 옵션 설정 가능
- Google Sheets API의 `setDataValidation`으로 일관성 유지

---

### 15. Airtable 완전 제거 및 Google Sheets 전환

**사용자 명령:**
```
에어테이블과 관련된 거 모두 지워줘. 에어테이블 안쓸거야. 다 구글시트로 쓸거야
```

**Claude Code 작업 흐름:**

1. **Airtable 관련 파일 탐색**
   - `**/\*airtable*` 패턴으로 검색 → `src/setup-airtable.js` 발견
   - `grep airtable|Airtable|AIRTABLE` 실행 → 13개 파일에서 참조 발견

2. **레거시 스크립트 삭제**
   - `src/setup-airtable.js` - 에어테이블 테이블 생성 스크립트
   - `src/setup-file-history.js` - 파일처리이력 테이블 생성
   - `src/migrate-to-sheets.js` - 마이그레이션 (완료됨, 불필요)
   - `src/process-pair.js` - 에어테이블 버전 PDF 처리
   - `src/seed-aliases.js` - 약어 시드 (에어테이블용)
   - `src/check-status.js` - 에어테이블 상태 체크
   - `src/update-file-urls.js` - 에어테이블 URL 업데이트
   - `src/fix-status.js` - 에어테이블 상태 수정
   - → 8개 파일 삭제 완료 ✅

3. **package.json 정리**
   - `airtable` 패키지 의존성 제거
   - `npm install` 실행 → 4개 패키지 제거됨 ✅

4. **CLAUDE.md 업데이트**
   - "Airtable Integration (레거시)" 섹션 전체 삭제
   - Commands에서 레거시 명령어 삭제
   - 주요 파일에서 `migrate-to-sheets.js` 삭제
   - Environment Variables에서 `AIRTABLE_API_KEY`, `AIRTABLE_BASE_ID` 삭제
   - `/update` 설명을 "Google Sheets에 선정결과 업데이트"로 변경

5. **/update 커맨드 재작성**
   - `.claude/commands/update.md` 전체 재작성
   - 에어테이블 API 내용 → Google Sheets API 내용으로 변경
   - 테이블 구조 → 시트 구조로 변경
   - 파일처리이력 → `processed.json` 로컬 관리로 변경

**최종 결과:**

| 작업 | 상태 |
|------|------|
| 레거시 스크립트 8개 삭제 | ✅ |
| airtable 패키지 제거 | ✅ |
| CLAUDE.md 정리 | ✅ |
| /update 커맨드 재작성 | ✅ |

**삭제된 파일:**
- `src/setup-airtable.js`
- `src/setup-file-history.js`
- `src/migrate-to-sheets.js`
- `src/process-pair.js`
- `src/seed-aliases.js`
- `src/check-status.js`
- `src/update-file-urls.js`
- `src/fix-status.js`

**수정된 파일:**
- `package.json` - airtable 의존성 제거
- `CLAUDE.md` - Airtable 관련 내용 전체 삭제
- `.claude/commands/update.md` - Google Sheets 버전으로 재작성

**현재 프로젝트 구조:**

```
src/
├── index.js          # 메인 (스크래핑 → 다운로드 → 업로드)
├── scraper.js        # Puppeteer KVIC 스크래퍼
├── googleDrive.js    # Google Drive API
├── googleSheets.js   # Google Sheets API ← 메인 DB
├── setup-sheets.js   # 시트 초기화
└── process-pair-sheets.js  # PDF 처리 (Sheets 버전)
```

**배운 점:**
- Airtable → Google Sheets 마이그레이션 완료 후 레거시 코드 정리 필수
- 관련 문서(CLAUDE.md, 커맨드)도 함께 업데이트해야 혼란 방지

---

### 16. /update 커맨드 자동 파일 매칭 기능 추가

**사용자 명령:**
```
update 커맨드에서 파일번호 주면 해당 파일과 매칭되는 파일 번호 찾아서 같이 처리하는거지? (지원현황파일, 선정결과파일)
```

**Claude Code 작업 흐름:**

1. **현재 구조 분석**
   - `process-pair-sheets.js` 확인 → 두 개 파일번호를 **수동으로 입력**받는 구조
   - 자동 매칭 로직 없음 ❌
   - 사용자 기대: 파일번호 하나 → 쌍 자동 찾기

2. **사업명 추출 함수 확인**
   - → 사용자 피드백: "그거 파일 열어서 상단 제목 파싱해서 판단하기로 했지 않니?"
   - `process-pair-sheets.js:248-254`에 사업명 추출 로직 있으나, 이건 출자사업 DB용
   - 파일 매칭용은 아직 없음

3. **googleSheets.js에 매칭 메서드 추가**
   - `extractProjectNameFromText(text)` - PDF 텍스트에서 사업명 추출
   - `normalizeProjectName(name)` - 사업명 정규화 (비교용)
   - `findMatchingFilePair(fileNo, projectName)` - 쌍 찾기
   - `isProjectNameMatch(projectName, fileName)` - 연도/키워드 매칭
   - `getPendingFilePairs()` - 처리 대기 중인 파일 쌍 조회

4. **update.md 커맨드 업데이트 (1차)**
   - 자동 파일 매칭 섹션 추가
   - 연도 + 키워드(해외/글로벌, 국내, VC) 기반 매칭 규칙

5. **사용자 상세 요구사항 정리**
   ```
   - 파일번호 하나 주면 출자사업이 동일한 다른 파일 하나를 찾아서 2개 같이 처리
   - 무조건 지원현황 먼저 처리
   - 출자사업, 운용사, 신청현황 업데이트
   - PDF 내부 표가 각기 달라서 AI 에이전트가 직접 열어보고 판단
   - 별도 API 키 없이 클로드코드가 직접 실행
   - 출자사업에 지원파일ID, 결과파일ID 각각 업데이트
   - 신청현황은 '지원' 상태로 생성 → 결과파일 분석 후 '선정' 또는 '탈락'으로 변경
   - 운용사명 약어/다른명 매칭도 AI가 판단
   - 처리 완료 시 파일 시트 처리상태/처리일시 업데이트
   ```

6. **플랜 모드 진입 및 설계**
   - 질문: "쌍이 없으면 어떻게 처리?" → 사용자 응답: "처리 중단"
   - 플랜 파일 작성: `/Users/dahye.dyan/.claude/plans/velvet-scribbling-liskov.md`

7. **update.md 커맨드 전면 재작성**
   - Step 1: 파일 매칭 (쌍 없으면 중단)
   - Step 2: 접수현황 PDF 처리 (먼저) → 신청현황 "지원" 상태
   - Step 3: 선정결과 PDF 처리 → "선정" 또는 "탈락"으로 변경
   - Step 4: 완료 처리 (파일 시트 업데이트)

**최종 결과:**

| 항목 | 변경 내용 |
|------|----------|
| 파일 매칭 | 파일번호 하나 → 사업명 기반 쌍 자동 검색 |
| 처리 순서 | 무조건 접수현황 먼저 |
| 상태 흐름 | 접수현황 → "지원" / 선정결과 → "선정" or "탈락" |
| PDF 분석 | Claude Code가 직접 Read 툴로 분석 (별도 API 없음) |
| 운용사 매칭 | AI가 약어/유사명 판단 |
| 쌍 없을 때 | 에러 메시지 출력 후 처리 중단 |

**수정된 파일:**
- `src/googleSheets.js` - 파일 매칭 메서드 5개 추가
- `.claude/commands/update.md` - 전면 재작성

**사용법:**
```
/update 4524
→ 4524 파일의 사업명 추출
→ 같은 사업명의 반대 유형 파일 자동 검색 (예: 4461)
→ 접수현황(4461) 먼저 처리 → 선정결과(4524) 처리
→ 완료
```

**배운 점:**
- Claude Code 내에서 직접 PDF 분석하면 별도 API 키 불필요
- 사업명 매칭은 연도 + 키워드로 충분히 정확함
- 상태 흐름: 지원 → 선정/탈락 (접수현황 먼저, 선정결과로 최종 상태 결정)

---

### 17. 4076 접수현황 PDF 처리 및 신청현황 등록

**사용자 명령:**
```
4076 문서를 보자.
문서에 있는 표의 '운용사명' 항목을 분석하여 다음의 두 가지 단계를 거쳐 수치를 도출했습니다.
1. 총 운용사 신청 현황 건수 (170건) 판단 과정
2. 고유 운용사 수 (125개) 판단 과정
이에 따라 구글시트에 업데이트해줘
```

**Claude Code 작업 흐름:**

1. **PDF 파일 확인**
   - `downloads/4076_한국모태펀드_중기부_소관__2024년_1차_정시_출자사업_접수_현황_.pdf` 확인 ✅
   - `pdftotext -layout`으로 텍스트 추출

2. **데이터 집계 기준 검증**
   - 사용자 분석: 170건, 125개
   - Claude 분석: 171건, 130개
   - → 미세한 차이 있으나 Claude 분석 결과(171건, 130개) 사용

3. **운용사 시트 등록**
   - 130개 고유 운용사 등록 시작
   - → 52개 등록 후 API 할당량 초과 ❌
   - 1분 대기 후 나머지 78개 등록 ✅
   - 총 130개 운용사 등록 완료

4. **신청현황 시트 등록 (1차 시도)**
   - 149건 등록 시도 (PDF 표 라인 수 기준)
   - → 58건 등록 후 API 할당량 초과 ❌

5. **사용자 피드백: 공동GP 분리**
   - → "공동인 경우 각각의 행으로 분리해줘야돼"
   - → 기존 데이터 삭제 후 재등록

6. **신청현황 시트 등록 (2차 시도)**
   - 공동GP 슬래시(`/`) 분리 → 각각 개별 행으로 등록
   - 배치 처리 (20건씩, 2초 대기)
   - 총 171건 등록 완료 ✅

7. **CLAUDE.md 데이터 집계 기준 추가**
   - 신청현황 건수: 공동GP 분리 후 총 운용사 참여 건수
   - 고유 운용사 수: 중복 제거
   - 결성예정액/출자요청액: 분야별 합계 (병합 행)

**최종 결과:**

| 시트 | 등록 건수 |
|------|----------|
| 운용사 | 130개 |
| 신청현황 | 171건 |
| 출자사업 | 1개 (PJ0001: 한국모태펀드 중기부 소관 2024년 1차 정시 출자사업) |

**분야별 신청현황:**

| 계정 | 분야 | 결성예정액 | 출자요청액 | 신청 건수 |
|------|------|-----------|-----------|----------|
| 중진 | 루키리그 | 6,652.6억 | 3,756억 | 35건 |
| 중진 | 스케일업·중견도약 | 3,140억 | 1,250억 | 7건 |
| 중진 | 여성기업 | 537억 | 300억 | 3건 |
| 중진 | 임팩트 | 1,338억 | 782억 | 11건 |
| 중진 | 재도약 | 2,034억 | 1,030억 | 10건 |
| 청년 | 청년창업 | 7,080억 | 3,950억 | 32건 |
| 혁신모험 | 창업초기 | 10,836.7억 | 6,060억 | 61건 |
| 소재부품장비 | 소재부품장비 | 2,859억 | 1,405억 | 12건 |

**수정된 파일:**
- `CLAUDE.md` - 데이터 집계 기준 섹션 추가

**배운 점:**
- 공동GP는 반드시 개별 행으로 분리 (슬래시 기준)
- Google Sheets API 할당량 관리: 배치 처리 + 대기 시간 필수
- PDF 표의 라인 수 ≠ 실제 신청현황 건수 (공동GP 분리 후 증가)

---

### 18. 4116 선정결과 PDF 처리 및 상태 업데이트

**사용자 명령:**
```
claude.md파일에 신청현황 등록하는 기준에 대해 언급해줘.
이후 4116 파일을 보고 신청현황의 선정결과를 업데이트 해줘
```

**Claude Code 작업 흐름:**

1. **CLAUDE.md 신청현황 등록 기준 추가**
   - 개별 행 원칙 (공동GP 분리)
   - 운용사ID 단일 값 입력
   - 출자분야 형식: "계정 - 분야"
   - 상태 값: 접수 → 선정/탈락

2. **선정결과 PDF 파싱**
   - `downloads/4116_한국모태펀드_중기부_소관__2024년_1차_정시_출자사업_선정_결과.pdf`
   - 선정 조합 43개, 최소결성규모 7,835.29억원, 모태출자액 4,160억원
   - PDF에 지방계정(지역 창업초기, 라이콘, 지역AC세컨더리) 포함

3. **선정 운용사 추출 (중기부 소관만)**
   - PDF 28개 조합 → 슬래시 분리 → 31개 운용사
   - → 사용자 피드백: "지원현황 문서 파싱기준과 동일하게 운용사는 슬래시 기준으로 나눠서"

4. **분야별 선정 현황:**

| 분야 | 선정 운용사 수 |
|------|---------------|
| 중진 - 루키리그 | 10개 |
| 중진 - 스케일업·중견도약 | 2개 |
| 중진 - 여성기업 | 1개 |
| 중진 - 임팩트 | 3개 |
| 중진 - 재도약 | 3개 |
| 청년 - 청년창업 | 3개 |
| 혁신모험 - 창업초기 | 7개 |
| 소재부품장비 | 2개 |
| **합계** | **31개** |

5. **신청현황 상태 업데이트**
   - 171건 중 선정 31건, 탈락 140건
   - API 할당량 초과 → 30초 대기 후 재시도
   - 파일 4116 처리상태 "완료"로 업데이트 ✅

**최종 결과:**

| 상태 | 건수 |
|------|------|
| 선정 | 31건 |
| 탈락 | 140건 |
| 합계 | 171건 |

**수정된 파일:**
- `CLAUDE.md` - 신청현황 등록 기준 섹션 추가
- `.claude/commands/update.md` - 공동GP 분리, 상태값, API 할당량 주의사항 반영

**배운 점:**
- 선정결과도 공동GP 슬래시 분리 필수
- 상태 업데이트는 분야 + 운용사ID로 매칭
- API 할당량 관리: 5개마다 2초 대기, 에러 시 30초 대기

---

## 2025-12-21: 신청현황 결성예정액/출자요청액 비어있는 건 수정

### 1. 신청현황 금액 필드 검토 및 수정

**사용자 명령:**
```
신청현황 중에 결성예정액과 출자요청액이 비어있는 것들이 있는데 검토해줘
```

**Claude Code 작업 흐름:**

1. **문제 파악을 위한 스크립트 작성**
   - `src/check-empty.js` 스크립트 생성
   - 신청현황 시트에서 결성예정액/출자요청액이 비어있는 건 조회
   - → ES 모듈 환경 이슈로 여러 번 수정 (require → import, 클래스 형태 확인)

2. **비어있는 건 분석**
   - 총 신청현황: 387건
   - 비어있는 건: **56건**
   - 모두 **문화 계정** 분야 (PJ0003: 모태펀드 문화/영화 2024년 1차 정시 출자사업)

3. **분야별 비어있는 건수:**
   | 출자분야 | 건수 |
   |---------|------|
   | 문화 - IP | 10건 |
   | 문화 - M&A-세컨더리 | 4건 |
   | 문화 - 문화일반 | 6건 |
   | 문화 - 수출 | 11건 |
   | 문화 - 신기술 | 16건 |
   | 문화 - 중저예산 한국영화 | 6건 |
   | 문화 - 한국영화 메인투자 | 3건 |

4. **원인 분석**
   - 관련 파일: `4073_붙임._모태펀드_문화__영화__해양__2024년_1차_정시_출자사업_신청_현황_게시용_최종.pdf`
   - PDF 확인 → **결성예정액/출자요청액이 분야별 합계로만 표시** (개별 운용사별 금액 없음)
   - 기존 파싱 코드(`process-pair-sheets.js`)의 AI 프롬프트에서 "분야별 합계이므로 개별 운용사에 할당하지 않음"으로 지시
   - → **CLAUDE.md 기준과 불일치** 발견

5. **CLAUDE.md 기준 확인**
   - "결성예정액/출자요청액: PDF 표에서 같은 병합된 행(분야)에 속한 운용사는 해당 분야의 결성예정액/출자요청액 값을 그대로 사용"
   - → 사용자 확인: "claude.md 기준이 맞아"

6. **PDF에서 분야별 금액 추출**
   ```
   IP:              4,510억 / 2,700억
   M&A-세컨더리:     1,135억 / 400억
   문화일반:         2,400억 / 1,200억
   수출:            3,400억 / 2,025억
   신기술:          3,683억 / 2,200억
   중저예산 한국영화: 1,383억 / 690억
   한국영화 메인투자:  840억 / 420억
   ```

7. **수정 스크립트 작성 및 실행**
   - `src/fix-empty-amounts.js` 생성
   - 분야별 금액 매핑 테이블 작성
   - Google Sheets API로 56건 일괄 업데이트
   - API 할당량 관리: 20건마다 1초 대기
   - → **56건 모두 수정 완료** ✅

8. **검증**
   - `check-empty.js` 재실행 → 비어있는 건: **0건** ✅

**최종 결과:**

| 출자분야 | 결성예정액 | 출자요청액 | 수정 건수 |
|---------|-----------|-----------|----------|
| 문화 - IP | 4,510 | 2,700 | 10건 |
| 문화 - M&A-세컨더리 | 1,135 | 400 | 4건 |
| 문화 - 문화일반 | 2,400 | 1,200 | 6건 |
| 문화 - 수출 | 3,400 | 2,025 | 11건 |
| 문화 - 신기술 | 3,683 | 2,200 | 16건 |
| 문화 - 중저예산 한국영화 | 1,383 | 690 | 6건 |
| 문화 - 한국영화 메인투자 | 840 | 420 | 3건 |
| **합계** | - | - | **56건** |

**생성된 파일:**
- `src/check-empty.js` - 비어있는 금액 필드 조회 스크립트
- `src/fix-empty-amounts.js` - 분야별 금액 일괄 업데이트 스크립트

**배운 점:**
- PDF 표에서 분야별 합계만 있을 때는 CLAUDE.md 기준대로 같은 분야의 모든 운용사에 동일 금액 입력
- 기존 파싱 코드의 AI 프롬프트가 CLAUDE.md 기준과 불일치할 수 있음 → 문서 기준 우선
- Google Sheets API 할당량 관리 필수 (배치 처리 + 대기 시간)

---

### 2. 파일번호 4152 출자사업 처리 및 파일유형 판단 기준 추가

**사용자 명령:**
```
/update 4152
```

**Claude Code 작업 흐름:**

1. **파일 시트에서 4152 정보 조회**
   - 파일번호 4152: `모태펀드_과기계정부_메타버스__2024_3월_수시_출자사업_서류심사_결과.hwp.pdf`
   - 파일유형: **선정결과** (파일명 기준)
   - 처리상태: 대기

2. **PDF 내용 확인 → 파일명과 불일치 발견**
   - `pdftotext -layout`으로 PDF 텍스트 추출
   - PDF 상단: **"모태펀드(과기계정) 2024년 3월 수시 출자사업 접수현황"**
   - → 파일명에는 "서류심사 결과"지만 실제 내용은 **접수현황** ❌
   - → 파일 시트 파일유형을 "접수현황"으로 수정 ✅

3. **매칭되는 선정결과 파일 검색**
   - 과기정통/메타버스/2024년 3월 수시 키워드로 검색
   - 4196: `모태펀드_과기정통부__2024년_3월_수시_출자사업_선정결과_게시용.pdf` → 선정결과
   - → **매칭 파일 쌍 확인 완료** ✅

4. **접수현황 PDF 파싱 (4152)**
   - 출자분야: 메타버스
   - 접수 운용사:
     - 미시간벤처캐피탈: 결성예정액 500억, 출자요청액 300억
     - 크릿벤처스-BNK벤처투자: 결성예정액 550억, 출자요청액 300억 (공동GP)

5. **운용사 및 신청현황 등록**
   - 운용사 시트 조회 → 미시간벤처캐피탈, 크릿벤처스 기존 존재 ✅
   - BNK벤처투자 신규 생성 (OP0219) ✅
   - 출자사업 신규 생성 (PJ0007: 모태펀드(과기계정) 2024년 3월 수시 출자사업) ✅
   - 신청현황 3건 등록 (공동GP 분리):
     - AP0409: 미시간벤처캐피탈 - 접수
     - AP0410: 크릿벤처스 - 접수 (비고: 공동GP)
     - AP0411: BNK벤처투자 - 접수 (비고: 공동GP)

6. **선정결과 PDF 파싱 (4196)**
   - 최종 선정 조합 1개: **미시간벤처캐피탈**
   - 크릿벤처스/BNK벤처투자는 선정되지 않음

7. **신청현황 상태 업데이트**
   - AP0409 (미시간벤처캐피탈): 접수 → **선정** ✅
   - AP0410 (크릿벤처스): 접수 → **탈락** ✅
   - AP0411 (BNK벤처투자): 접수 → **탈락** ✅

8. **파일 시트 완료 처리**
   - FH0007 (4152): 처리상태 "완료", 처리일시 업데이트 ✅
   - FH0014 (4196): 처리상태 "완료", 처리일시 업데이트 ✅

**최종 결과:**

| 항목 | 값 |
|------|-----|
| 매칭 파일 쌍 | 4152 (접수현황) ↔ 4196 (선정결과) |
| 출자사업 | PJ0007 (신규) |
| 신규 운용사 | 1개 (BNK벤처투자) |
| 기존 운용사 재사용 | 2개 (미시간벤처캐피탈, 크릿벤처스) |
| 신청현황 | 3건 |
| 선정 | 1건 (미시간벤처캐피탈) |
| 탈락 | 2건 (크릿벤처스, BNK벤처투자) |

---

**사용자 추가 요청:**
```
방금처럼 제목은 결과인데 내용이 접수현황인거면 내용이 더 정확한거니까 파일 시트의 파일유형값도 바꿔주고 이런 케이스에 대한 것도 claude.md에 지침 추가해줘
```

**Claude Code 작업 흐름:**

1. **CLAUDE.md에 "파일유형 판단 기준" 섹션 추가**
   - **PDF 내용 우선 원칙**: 파일명과 PDF 내용이 다를 경우, PDF 내용을 기준으로 파일유형 판단
   - 파일명에 "선정결과", "심사결과" 있어도 PDF 내용이 "접수현황"이면 → 파일유형: `접수현황`
   - 파일명에 "접수현황", "신청현황" 있어도 PDF 내용이 "선정결과"이면 → 파일유형: `선정결과`
   - 파일 시트 파일유형 컬럼도 수정하고 로그에 기록

**수정된 파일:**
- `CLAUDE.md` - 파일유형 판단 기준 섹션 추가

**배운 점:**
- 파일명은 사람이 붙인 것이라 오류가 있을 수 있음 → **PDF 내용이 진실**
- PDF 상단 제목/헤더에서 "접수현황", "신청현황", "선정결과", "심사결과" 키워드 확인
- 불일치 발견 시 파일 시트의 파일유형 컬럼도 함께 수정

---

### 3. PJ0008 금액 필드 수정 (USD M → 실제 금액)

**사용자 명령:**
```
이미 통화단위를 결정했다면 결성예정액, 출자요청액에서 단위는 빼줘야지. 그건 숫자가 들어가는 곳이니까. 출자사업 PJ0008 인 신청현황들의 필드를 확인 및 수정하고, 이후 claude.md에도 지침 추가해줘
```

**Claude Code 작업 흐름:**

1. **PJ0008 신청현황 데이터 조회**
   - PJ0008: 2024년 해외VC 글로벌 펀드 출자사업
   - 총 31건의 신청현황 확인
   - 결성예정액/출자요청액에 "USD 1,842M" 형태로 문자열 저장됨 ❌

2. **1차 수정: 단위 문자 제거 (31건)**
   - `USD 1,842M` → `1842`
   - `USD 167.7M` → `167.7`
   - → 실행 완료 ✅

3. **사용자 피드백: M(백만) 단위도 실제 금액으로 변환 필요**
   - → "그건 통화단위를 보고 결정해야지"
   - USD인 경우 M(백만) 단위 × 1,000,000
   - KRW인 경우 억원 단위 × 100,000,000

4. **2차 수정 시도 → 일부 데이터 0으로 변경됨 ❌**
   - 원인: 일부 행들은 아직 "USD 4,262.8M" 형태의 문자열이 남아있어서 `parseFloat()` 실패
   - 30건이 결성예정액/출자요청액 모두 0으로 변경됨

5. **0으로 변경된 30건 원인 분석**
   - 유럽/중동 - 일반: 8건
   - 아시아 - 일반: 22건
   - → PDF 원본에서 해당 분야의 금액 확인 필요

6. **PDF 원본에서 금액 확인 (4153 파일)**
   - 미국: 결성예정액 USD 1,842M, 출자요청액 USD 167.7M
   - 유럽/중동: 결성예정액 USD 4,262.8M, 출자요청액 USD 221.7M
   - 아시아: 결성예정액 USD 5,295M, 출자요청액 USD 332.3M

7. **30건 복구 완료**
   - 유럽/중동 8건: 결성예정액 `4262800000`, 출자요청액 `221700000`
   - 아시아 22건: 결성예정액 `5295000000`, 출자요청액 `332300000`

8. **사용자 피드백: Co-GP 20건도 아직 미수정**
   - → "Co-GP에 해당하는 건 아직 금액이 안바뀌었어"
   - Co-GP 분야: 결성예정액 USD 941.8M, 출자요청액 USD 103.9M
   - 20건 추가 수정: `941800000`, `103900000` ✅

9. **CLAUDE.md 금액 필드 지침 수정**
   - 기존: "숫자만 입력" (단위 제거)
   - 변경: "실제 금액(숫자)으로 저장" (단위를 실제 금액으로 변환)
   - USD: M(백만) × 1,000,000
   - KRW: 억원 × 100,000,000

**최종 결과:**

| 작업 | 건수 |
|------|------|
| 1차 수정 (단위 문자 제거) | 31건 |
| 0으로 변경된 건 복구 | 30건 |
| Co-GP 금액 수정 | 20건 |
| **총 수정** | **81건** |

**PJ0008 분야별 금액 (실제 USD):**

| 분야 | 결성예정액 | 출자요청액 |
|------|-----------|-----------|
| 미국 - 일반 | 1,842,000,000 | 167,700,000 |
| 유럽/중동 - 일반 | 4,262,800,000 | 221,700,000 |
| 아시아 - 일반 | 5,295,000,000 | 332,300,000 |
| Co-GP | 941,800,000 | 103,900,000 |

**수정된 파일:**
- `CLAUDE.md` - 금액 필드 형식 지침 수정 (실제 금액으로 변환)

**배운 점:**
- 금액 필드는 단순히 단위 문자를 제거하는 것이 아니라, **실제 금액으로 변환**해야 함
- M(Million) = × 1,000,000
- 억원 = × 100,000,000
- 문자열 파싱 시 `parseFloat()` 실패하면 0이 됨 → 원본 문자열 형태 확인 필수
- 일괄 수정 시 일부 데이터 누락 가능성 항상 검증 필요

---

*이 파일은 Claude Code 작업 내역을 추적하기 위해 자동 생성되었습니다.*

---

## 2025-12-21: 파일번호 4153 출자사업 처리

### 1. 2024년 해외VC 글로벌 펀드 출자사업 처리

**사용자 명령:**
```
/update 4153
```

**Claude Code 작업 흐름:**

1. **파일 정보 조회**
   - 파일 시트에서 파일번호 4153 조회 → FH0008 확인
   - 파일유형: 접수현황
   - 파일명: `4153_2024년_해외VC_글로벌_펀드_출자사업_접수_현황.pdf`
   - 처리상태: 대기

2. **반대 유형 파일 찾기**
   - "2024년 해외VC 글로벌 펀드" 키워드로 선정결과 파일 검색
   - → 파일번호 4202 (FH0017) 매칭 ✅
   - 파일명: `4202_2024년_해외VC_글로벌_펀드_출자사업_최종_선정결과.pdf`

3. **접수현황 PDF 파싱**
   - `pdftotext -layout` 명령으로 PDF 텍스트 추출
   - 데이터 구조 분석:
     - 일반분야: 70개 조합 (미국 18, 유럽/중동 21, 아시아 31)
     - Co-GP분야: 10개 조합 (해외-국내 쌍)
   - 공동GP 분리 후 총 90개 신청현황 예상

4. **운용사 및 신청현황 등록 (1차 시도)**
   - 스크립트 작성: `src/process-overseas-vc-2024.js`
   - → 31개 등록 후 API 할당량 초과 (429 Too Many Requests) ❌
   - 원인: 각 운용사마다 `findRow()` 호출 → API 요청 과다

5. **배치 처리 방식으로 수정 (2차 시도)**
   - 1분 대기 후 API 할당량 복구
   - 스크립트 수정: 메모리에서 매칭 후 배치 등록
   - 기존 31개 스킵, 나머지 59개 배치 등록 ✅
   - 운용사: 58개 신규, 신청현황: 59개 신규

6. **선정결과 PDF 파싱 및 상태 업데이트**
   - 선정된 운용사 목록 추출:
     - 미국: ACVC, IgniteXL, Nautilus, Patron, Third Prime (5개)
     - 유럽/중동: Amadeus Capital, Mosaic Ventures (2개)
     - 아시아: Access, DG Daiwa, K3, Lion X, Qualgro (5개)
     - Co-GP: VentureSouq-IMM, CICC-Ascent, Global Brain-Shinhan (3쌍)
   - → "Mosaic Ventures" 매칭 실패 ❌ (접수현황 PDF에 없음)
   - 60개 상태 업데이트 후 API 할당량 초과

7. **남은 상태 업데이트 완료**
   - 1분 대기 후 나머지 24개 상태 업데이트
   - 파일 처리상태: 완료로 변경
   - 출자사업 결과파일ID 연결: FH0017

**중간 결과:**

| 항목 | 값 |
|------|-----|
| 출자사업 ID | PJ0008 |
| 신규 운용사 | 89개 |
| 신청현황 | 90건 |
| 선정 | 15건 |
| 탈락 | 75건 |

---

### 2. 접수현황에 없는 선정 운용사 추가

**사용자 명령:**
```
접수현황에는 없는데 선정결과에 있는 건 '선정'으로 신청현황에 추가해주고 비고란에 해당사항을 적어줘
```

**Claude Code 작업 흐름:**

1. **누락된 운용사 식별**
   - 선정결과 PDF에는 있지만 접수현황 PDF에 없는 운용사 확인
   - → "Mosaic Ventures" (유럽/중동) 1건 확인

2. **운용사 생성**
   - OP0309: Mosaic Ventures (해외VC, 유럽/중동)
   - → 초기 생성 시 "국내VC, 한국"으로 잘못 설정됨 ❌
   - → 수동으로 유형/국가 수정 ✅

3. **신청현황 추가**
   - AP0507 생성
   - 출자분야: 유럽/중동 - 일반
   - 상태: 선정
   - 비고: "접수현황 PDF에 미기재, 선정결과에서 확인됨"

**최종 결과:**

| 항목 | 값 |
|------|-----|
| 출자사업 ID | PJ0008 |
| 사업명 | 2024년 해외VC 글로벌 펀드 출자사업 |
| 총 운용사 | 309개 (신규 90개) |
| 총 신청현황 | 91건 |
| 선정 | 16건 |
| 탈락 | 75건 |

**분야별 신청현황:**

| 분야 | 건수 |
|------|------|
| 미국 - 일반 | 18건 |
| 유럽/중동 - 일반 | 22건 (Mosaic 포함) |
| 아시아 - 일반 | 31건 |
| Co-GP | 20건 |

**처리된 파일:**

| 파일번호 | 파일유형 | 처리상태 |
|---------|---------|---------|
| 4153 (FH0008) | 접수현황 | 완료 |
| 4202 (FH0017) | 선정결과 | 완료 |

**배운 점:**
- Google Sheets API는 분당 요청 제한이 있음 → 배치 처리 필수
- 개별 `findRow()` 호출 대신 메모리에 전체 데이터 로드 후 매칭
- 접수현황에 없지만 선정결과에 있는 케이스 존재 가능 → 별도 처리 필요
- 운용사 생성 시 region 파라미터가 제대로 적용되지 않는 경우 있음 → 수동 검증 필요

---

## 2025-12-21: 출자사업 현황 필드 추가 및 중복 데이터 정리

### 1. 출자사업 '현황' 필드 추가

**사용자 명령:**
```
혹시 출자사업에 '현황' 필드 추가하고, 총 신청현황 몇 건이고 선정과 탈락 각 몇건인지 표기할 수 있을까?
```

**Claude Code 작업 흐름:**

1. **시트 구조 확인**
   - `setup-sheets.js` 확인 → 출자사업 헤더에 '현황' 컬럼 없음
   - `googleSheets.js` 확인 → 현황 관련 함수 없음

2. **코드 수정**
   - `setup-sheets.js`: 출자사업 헤더에 '현황' 컬럼 추가 (I열)
   - `googleSheets.js`: `updateProjectStatus()`, `updateAllProjectStatuses()` 함수 추가
   - `process-pair-sheets.js`: PDF 처리 완료 후 현황 자동 업데이트 로직 추가

3. **시트 헤더 업데이트**
   - `node src/setup-sheets.js` 실행 → 드롭다운 설정 에러 발생 (기존 데이터 있어서)
   - → 헤더만 직접 업데이트: `client.setValues('출자사업!A1:I1', [...])`

4. **전체 출자사업 현황 업데이트**
   - `sheets.updateAllProjectStatuses()` 실행 → 9개 출자사업 현황 업데이트 완료 ✅

**생성/수정된 파일:**
- `src/setup-sheets.js` - 출자사업 헤더에 '현황' 추가
- `src/googleSheets.js` - `updateProjectStatus()`, `updateAllProjectStatuses()` 함수 추가
- `src/process-pair-sheets.js` - [9] 출자사업 현황 업데이트 단계 추가

**현황 형식:** `총 171건 (선정 45, 탈락 126)`

---

### 2. CLAUDE.md와 update.md 지침 정리

**사용자 명령:**
```
질문이 있어. claude.md의 지침하고 update.md 커스텀커맨드 지침하고 뭘 더 우선해서 보는거야 넌?
```

**Claude Code 작업 흐름:**

1. **우선순위 설명**
   - 두 파일은 동일한 우선순위
   - 충돌 시 더 구체적인 지침(커스텀 커맨드)을 따름
   - → 사용자가 중복 제거 요청

2. **파일 분석 및 정리**
   - CLAUDE.md: 시트 구조, 공동GP, API 할당량 등 중복 발견
   - update.md: 같은 내용이 중복으로 있음

3. **CLAUDE.md 정리**
   - 공통 규칙만 유지 (시트 구조, 비즈니스 규칙, 환경변수)
   - 중복 제거 및 구조화

4. **update.md 정리**
   - 상단에 `> CLAUDE.md 참조` 표시
   - Step 1~4 처리 흐름만 유지
   - 중복 내용 제거

**수정된 파일:**
- `CLAUDE.md` - 공통 규칙 정리, 현황 필드 지침 추가
- `.claude/commands/update.md` - 작업 특화 로직만 유지

---

### 3. PJ0003 (문화/영화) 중복 신청현황 발견 및 정리

**사용자 명령:**
```
근데 선정이 왜 31개야?
```

**Claude Code 작업 흐름:**

1. **초기 분석**
   - PJ0003 현황: `총 100건 (선정 31, 탈락 69)`
   - PDF 선정결과 확인 → **15개 조합** 선정
   - → "31건은 너무 많다. 중복이 있는 것 같다"

2. **중복 확인**
   - 선정 신청현황 31건 중 고유 운용사 14개 확인
   - → 같은 운용사가 여러 번 등록됨

3. **중복 유형 분석**
   - 사용자 피드백: "출자분야가 다르면 각기 다른 신청현황"
   - → 출자사업ID + 운용사ID + **출자분야** 조합으로 중복 체크
   - 결과: 44건 중복 발견 (같은 운용사 + 같은 분야)

4. **중복 원인 추적**
   - ID 패턴 분석: AP0180~AP0223 (첫 번째), AP0224~AP0267 (두 번째)
   - 모든 중복 쌍의 ID 차이가 정확히 **44**
   - → 같은 PDF를 **두 번 처리**한 것으로 확인

5. **파일 처리 기록 확인**
   - 4073 (접수현황): 2025-12-20T**13:47:43** 처리
   - 4148 (선정결과): 2025-12-20T**15:42:02** 처리
   - → 2시간 차이로 각각 처리됨

6. **추가 발견: 지원파일ID 공유**
   - PJ0002 (해양): 지원파일ID = FH0082
   - PJ0003 (문화/영화): 지원파일ID = FH0082 (동일!)
   - → 하나의 PDF(4073: 문화/영화/해양)가 두 출자사업에 연결됨
   - → 같은 PDF를 다른 출자사업으로 재처리할 때 중복 발생

7. **중복 삭제**
   - 대상: AP0180 ~ AP0223 (44건, 첫 번째 처리분)
   - 방법: 행 번호 역순으로 삭제 (인덱스 꼬임 방지)
   - 결과: 44건 삭제 완료 ✅

8. **현황 업데이트**
   - 기존: `총 100건 (선정 31, 탈락 69)`
   - 수정: `총 56건 (선정 17, 탈락 39)` ✅

**CLAUDE.md에 중복 방지 지침 추가:**

```markdown
### 신청현황 중복 방지

**중복 체크 기준**: 출자사업ID + 운용사ID + 출자분야 조합

- 같은 출자사업에 같은 운용사가 같은 분야로 신청한 경우 → 중복
- 같은 운용사가 **다른 분야**에 신청한 경우 → 별도 신청현황 (정상)

**주의**: 하나의 PDF에 여러 출자사업(계정)이 포함된 경우
- 예: `모태펀드_문화__영화__해양__출자사업`
- 같은 PDF를 다른 출자사업으로 재처리할 때 중복 생성 주의
```

**수정된 파일:**
- `CLAUDE.md` - 신청현황 중복 방지 지침 추가

**배운 점:**
- 같은 PDF가 여러 출자사업에 연결될 수 있음
- 중복 체크는 출자사업ID + 운용사ID만으로 부족, **출자분야**까지 포함해야 함
- ID 패턴 분석으로 중복 원인 추적 가능 (일정한 차이 = 동일 데이터 재처리)
- 행 삭제 시 역순으로 해야 인덱스가 꼬이지 않음



---

## 2025-12-21: PDF 파싱 개선 (pdfplumber 도입)

### 1. FH0006 신청현황 개수 확인

**사용자 명령:**
```
FH0006 파일의 지원현황에서 신청현황 몇 개인지 다시 pdf 보고 세어줘
```

**Claude Code 작업 흐름:**

1. **파일 정보 확인**
   - FH0006 = 파일번호 4151 (모태펀드_문체부_등__2024년_2차_정시_출자사업_접수_현황)
   - PDF 상단 명시: "신청조합 수 41개"
   - 실제 운용사 수: 공동GP 분리 후 계산 필요

2. **PDF 내용 분석 (pdftotext -layout)**
   - 분야별 운용사 목록 추출
   - 공동GP 분리 후 총 57개 운용사 확인

---

## 2025-12-21: PDF 파싱 개선 (pdfplumber 도입)

### 1. FH0006 신청현황 분야 오류 발견

**문제**: pdftotext -layout이 표 셀 경계를 인식하지 못해 "빅뱅벤처스, 제타플랜인베스트"가 스포츠산업으로 잘못 분류됨 (실제: 스포츠프로젝트)

### 2. pdfplumber 기반 PDF 파서 개발

**해결책**: Python pdfplumber 라이브러리 도입 → 표 구조(라인) 인식

**생성된 파일:**
- `src/pdf-parser.py` - pdfplumber 기반 PDF 표 파서
- `src/process-pair-sheets.js` - pdfplumber 우선, AI 폴백 전략 적용

### 3. FH0006 데이터 수정

| ID | 운용사 | 수정 전 | 수정 후 |
|----|--------|---------|---------|
| AP0359 | 빅뱅벤처스 | 스포츠 - 스포츠산업 | 스포츠 - 스포츠프로젝트 |
| AP0360 | 제타플랜인베스트 | 스포츠 - 스포츠산업 | 스포츠 - 스포츠프로젝트 |
| AP0361 | 솔트룩스벤처스 | 스포츠 - 스포츠산업 | 스포츠 - 스포츠프로젝트 |

### 4. CLAUDE.md 업데이트

- PDF 파싱 전략 섹션 추가
- Dependencies 섹션 추가 (pdfplumber, pdftotext)

---

## 2025-12-21: PDF 처리 검토/승인 워크플로우 추가

### 1. 검토 프로세스 필요성 논의

**사용자 요청:**
```
PDF 처리가 잘 되었는지 검토하는 프로세스를 추가해야할 거 같아
```

**Claude Code 작업 흐름:**

1. **방법론 제안**
   - 자동 검증: 건수 비교, 필수 필드 체크
   - 리포트 생성: 처리 결과 요약 출력
   - 수동 검토 단계: 확인 후 저장
   - 차이 비교: 접수/선정 크로스체크

2. **사용자 선택**
   - → 리포트 출력 + 승인받고 진행하는 방식 선택
   - → 터미널 테이블 출력 + 간단한 수정 가능 요구

### 2. 검토 워크플로우 설계 (Plan Mode)

**설계 결정사항:**
- 삽입 위치: `[6] 신청현황 생성` 직전 (라인 358 부근)
- 리포트 출력: cli-table3 라이브러리 사용
- 사용자 입력: readline (Node.js 내장)
- 수정 가능 필드: 운용사명, 출자분야, 상태

### 3. 구현

**생성된 파일:**
- `src/review-workflow.js` - 검토 세션 클래스, 테이블 렌더링, 사용자 인터랙션

**수정된 파일:**
- `src/process-pair-sheets.js` - 검토 단계 통합
- `package.json` - cli-table3 의존성 추가
- `CLAUDE.md` - 검토/승인 워크플로우 섹션 추가

**구현 흐름:**
```
[6] 데이터 검토 준비 (운용사 조회)
    ↓
리포트 출력 (테이블 형태)
    ↓
명령어 입력 대기 (y/n/e/r/s)
    ↓
[7] 신청현황 생성 (승인 시)
```

**명령어:**
- `y` - 승인 후 저장
- `n` - 취소 (저장 안함)
- `e` - 항목 수정 (인덱스 선택)
- `r` - 리포트 다시 보기
- `s` - 요약만 보기

### 4. update.md 수정 논의

**문제 발견:**
- `/update` 스킬: Claude가 직접 PDF 처리
- `process-pair-sheets.js`: CLI 스크립트로 검토 워크플로우 포함
- → 두 워크플로우가 다르게 동작

**해결:**
- `/update`를 스크립트 실행 트리거로 변경
- Claude가 파일 쌍 찾기 (AI 판단) → `node src/process-pair-sheets.js` 실행

**수정된 파일:**
- `.claude/commands/update.md` - 스크립트 호출 방식으로 변경

### 5. PDF 파싱 전략 변경: AI 우선

**사용자 의견:**
```
표 구조는 거의 다 달라. AI 우선이 낫겠어.
```

**변경 내용:**
- 기존: pdfplumber 우선, AI 폴백
- 변경: **AI 우선** (PDF 구조가 다양하므로)

**수정된 파일:**
- `src/process-pair-sheets.js`
  - `parsePdfWithPdfplumber()` 함수 제거
  - `parseApplicationPdf()` AI만 사용하도록 변경
- `CLAUDE.md` - PDF 파싱 전략 설명 업데이트

### 6. 최종 워크플로우

```
/update 4524
    ↓
Claude가 파일 쌍 찾음 (AI 판단)
    ↓
node src/process-pair-sheets.js 4461 4524
    ↓
[1] PDF 파싱 (AI)
[2] 약어 매핑 로드
[3] 출자사업 확인
[4] 파일DB 생성
[5] 기존 데이터 확인
[6] 데이터 검토 (터미널 테이블)
    ↓
y/n/e 입력
    ↓
[7] 신청현황 생성 (승인 시)
[8] 새 약어 저장
[9] 파일DB 업데이트
[10] 출자사업 현황 업데이트
```

---

## 2025-12-21: 운용사 유사도 검토 기능 추가

### 1. 기존 운용사 찾기 로직 분석

**사용자 질문:**
```
기존운용사 찾을 때 정확히 어떤 기준으로 찾아?
신규운용사 등록하기 전에 리스트업 한 다음에 기존 운용사 목록 중에 진짜 같은 게 없는지 다시 검토하는 프로세스를 추가하자. 이때 동일글자가 많거나 영문의 경우 약어가 아닌지 그 관점으로 다시 검토해. 그리고 조금 헷갈리는 게 있으면 사용자에게 바로 검토 요청해.
```

**Claude Code 작업 흐름:**

1. **기존 로직 분석**
   - `googleSheets.js`의 `getOrCreateOperator()` 함수 확인
   - → **정확히 운용사명이 일치**할 때만 기존 운용사로 인식
   - → 문제점 발견:
     - "KB인베스트먼트" vs "케이비인베스트먼트" → 별개로 인식 ❌
     - "STIC Investments" vs "스틱인베스트먼트" → 별개로 인식 ❌
     - "한국" vs "한국벤처투자" (부분 매칭) → 별개로 인식 ❌

2. **해결 방안 설계**
   - 신규 운용사 등록 전 유사도 검사 추가
   - 유사도 60% 이상이면 사용자에게 확인 요청
   - 영문 약어 ↔ 한글 발음 매칭 지원

### 2. 운용사 유사도 검사 모듈 개발

**생성된 파일:**
- `src/operator-matcher.js` - 운용사 유사도 매칭 유틸리티

**구현된 유사도 검사 항목:**
- Levenshtein 거리 기반 문자열 유사도
- 한글 자모 분해 비교 (케이비 vs KB)
- 초성 비교
- 영문 약어 ↔ 한글 발음 매핑:
  ```
  KB → 케이비, NH → 엔에이치, SK → 에스케이
  STIC → 스틱, Stonebridge → 스톤브릿지
  ```
- 회사 접미사 제거 후 비교 (인베스트먼트, 벤처스, 파트너스 등)
- 부분 문자열 포함 관계 확인

**유사도 점수 해석:**
- 95% 이상: 거의 확실히 동일
- 85% 이상: 동일 가능성 높음
- 75% 이상: 유사함, 확인 필요
- 60% 이상: 일부 유사, 검토 권장

### 3. GoogleSheetsClient 확장

**수정된 파일:**
- `src/googleSheets.js`
  - `getAllOperators()` 메서드 추가
  - `findSimilarOperatorsFromDB()` 메서드 추가
  - `formatSimilarOperatorsForReview()` 메서드 추가

### 4. PDF 처리 워크플로우 통합

**수정된 파일:**
- `src/process-pair-sheets.js`
  - `askQuestion()` 함수 추가 (터미널 입력)
  - `reviewNewOperators()` 함수 추가 (유사 운용사 검토)
  - `[5.5] 신규 운용사 유사도 검토` 단계 추가

**새로운 워크플로우:**
```
[5] 기존 데이터 확인
    ↓
[5.5] 신규 운용사 유사도 검토  ← 새로 추가
    ├─ 기존 운용사 목록 조회
    ├─ 유사 운용사 찾기 (60% 이상)
    └─ 사용자 확인 요청:
       [y] 같은 운용사 → 기존 ID 사용
       [n] 다른 운용사 → 신규 등록
       [s] 건너뛰기 → 나중에 처리
    ↓
[6] 데이터 검토 준비
```

**터미널 출력 예시:**
```
────────────────────────────────────────────────────────────
⚠️  유사 운용사 검토 필요 (3건)
────────────────────────────────────────────────────────────

  📌 신규: "STIC Investments"
     기존: "스틱인베스트먼트" (OP0042)
     유사도: 85% - 영문 약어 ↔ 한글명 매칭 가능

  → 같은 운용사인가요? [y=기존 사용 / n=신규 등록 / s=건너뛰기]:
```

### 5. 문서화

**수정된 파일:**
- `CLAUDE.md` - 운용사 매칭 규칙 섹션 추가

**추가된 내용:**
- 매칭 기준 (우선순위순)
- 유사도 검사 항목
- 영문 약어 매핑 예시
- 검토 프로세스 설명
- 주의사항

### 6. 최종 결과

**구현 완료 항목:**
- ✅ 운용사 유사도 검사 유틸 함수 작성
- ✅ googleSheets.js에 유사 운용사 검색 메서드 추가
- ✅ process-pair-sheets.js에 신규 운용사 검토 프로세스 통합
- ✅ CLAUDE.md에 운용사 매칭 규칙 문서화

**기대 효과:**
- 중복 운용사 등록 방지
- "KB인베스트먼트" = "케이비인베스트먼트" 자동 매칭 (사용자 확인 후)
- 영문 약어와 한글명 간 매칭 지원

---

## 2025-12-21: 부산 미래성장 벤처펀드 2024년 출자사업 PDF 처리

### 1. /update 4250 실행

**사용자 명령:**
```
/update 4250
```

**Claude Code 작업 흐름:**

1. **파일 정보 조회**
   - 파일번호 4250 조회 → FH0021, 접수현황 파일
   - 파일명: `4250_붙임._부산_미래성장_벤처펀드_2024년_출자사업_서류접수_현황_한국벤처투자.pdf`

2. **파일 쌍 찾기**
   - "부산" 키워드로 파일 시트 검색
   - 4250 (접수현황) ↔ 4272 (선정결과) 매칭 성공 ✅
   - 사업명: 부산 미래성장 벤처펀드 2024년 출자사업

3. **이중 파싱 (Claude Code + pdfplumber)**
   
   **접수현황 PDF 분석:**
   - 신청조합 수: 23개 (펀드 단위)
   - 공동GP 분리 후: 33건 (운용사 단위)
   - 출자분야: 지역리그(VC), 지역리그(AC), 수도권리그, 수도권리그(CVC), 글로벌리그

   **선정결과 PDF 분석:**
   - 선정조합 수: 11개 (펀드 단위)
   - 공동GP 분리 후: 18건 (운용사 단위)

4. **pdfplumber 파싱 이슈 발견**
   - 글로벌리그 "한양증권/MCP Asset Management Co., Ltd." 잘못 분리 ❌
   - pdfplumber 결과: "한양증권/MCP Asset Management Co." + "Ltd."
   - → Claude Code 결과 사용: "한양증권" + "MCP Asset Management Co., Ltd."
   
   - 선정결과 제목 라인 노이즈 발견 ❌
   - "부산 미래성장 벤처펀드" + "2024년 출자사업 선정 결과" 잘못 인식
   - → 해당 2건 제외하고 처리

5. **데이터 저장**
   
   **출자사업 생성:**
   - ID: PJ0013
   - 사업명: 부산 미래성장 벤처펀드 2024년 출자사업
   - 소관: 부산시
   - 지원파일ID: FH0021, 결과파일ID: FH0024

   **운용사 등록:**
   - 신규: 15건
   - 기존: 18건

   **신청현황 저장:**
   - 총 33건 (선정 18, 탈락 15)
   - 배치 처리 (10건씩, 2초 대기)

6. **파일 처리상태 업데이트**
   - FH0021 (4250) → 완료
   - FH0024 (4272) → 완료
   - 출자사업 현황: "총 33건 (선정 18, 탈락 15)"

### 2. 신규 운용사 유사도 검토 (사후)

**사용자 지적:**
```
신규 운용사 리스트업하고 검토 로직 한 번 돌리기로 하지 않았어?
```

**Claude Code 작업 흐름:**

1. **문제 인식**
   - 신규 운용사 등록 전 유사도 검토 단계를 건너뜀 ❌
   - 바로 등록 진행해버림

2. **사후 유사도 검사 실행**
   - 신규 15건에 대해 기존 350건과 비교
   - 임계값 50% → 유사 운용사 없음

3. **의심 운용사 추가 검토**
   - "아이비케이캐피탈" 검토 필요
   - 기존 DB에 "아이비케이벤처투자" (OP0342) 존재
   - → 같은 회사인지 다른 회사인지 확인 필요

4. **사용자 질문**
   ```
   1. 아이비케이캐피탈 과 IBK캐피탈 는 확실히 달라?
   2. 아이비케이벤처투자 와 아이비케이캐피탈 는 확실히 달라?
   ```

5. **웹검색으로 확인**
   - WebSearch 실행 → IBK 계열사 구조 파악
   
   **결론:**
   - 아이비케이캐피탈 = IBK캐피탈 (같은 회사, 한글 표기)
   - 아이비케이벤처투자 ≠ 아이비케이캐피탈 (다른 법인)
     - IBK벤처투자: 벤처캐피탈 (신기술사업금융사)
     - IBK캐피탈: 여신전문금융사 (리스, 할부금융)
   
   → 신규 등록 정상 ✅

### 3. CLAUDE.md 지침 추가

**사용자 명령:**
```
이렇게 중간에 헷갈리면 직접 웹검색하는 것도 지침에 추가해줘.
```

**수정된 파일:**
- `CLAUDE.md` - 운용사 매칭 규칙 > 주의사항에 웹검색 지침 추가

**추가된 내용:**
```markdown
- **헷갈리면 웹검색**: 유사 운용사가 같은 회사인지 다른 회사인지 판단이 어려우면 WebSearch로 직접 검색하여 확인
  - 예: "아이비케이캐피탈 vs IBK벤처투자" → 검색 결과 IBK 계열사지만 별개 법인임을 확인
```

### 4. 최종 결과

**처리 완료:**
| 항목 | 내용 |
|------|------|
| 출자사업 | PJ0013 - 부산 미래성장 벤처펀드 2024년 출자사업 |
| 접수현황 파일 | FH0021 (4250번) - 완료 |
| 선정결과 파일 | FH0024 (4272번) - 완료 |
| 신청현황 | 총 33건 (선정 18, 탈락 15) |
| 신규 운용사 | 15건 |

**신규 등록된 운용사:**
1. 비전에쿼티파트너스 (OP0351)
2. 선보엔젤파트너스 (OP0352)
3. 공명파트너즈 (OP0353)
4. 보더라인벤처스 (OP0354)
5. 부산창조경제혁신센터 (OP0355)
6. 비스퀘어 (OP0356)
7. 그래비티벤처스 (OP0357)
8. 시리즈벤처스 (OP0358)
9. 테일벤처스 (OP0359)
10. 아이비케이캐피탈 (OP0360)
11. 유안타인베스트먼트 (OP0361)
12. 지앤텍벤처투자 (OP0362)
13. 오픈워터인베스트먼트 (OP0363)
14. 한양증권 (OP0364)
15. MCP Asset Management Co., Ltd. (OP0365)

**교훈:**
- 신규 운용사 등록 전 유사도 검토 단계를 반드시 거칠 것
- 유사 운용사 판단이 어려우면 웹검색으로 확인
- IBK 계열사처럼 비슷한 이름이라도 별개 법인일 수 있음

---

## 2025-12-21: 중기부 10월 수시 출자사업 처리 및 운용사 유사도 필터 개선

### 1. /update 4279 실행

**사용자 명령:**
```
/update 4279
```

**Claude Code 작업 흐름:**

1. **파일 정보 조회**
   - 파일번호 4279 조회 → FH0026
   - 파일명: `한국모태펀드 중기부 소관 2024년 10월 수시 출자사업 접수 현황`
   - 파일유형: 접수현황

2. **파일 쌍 찾기**
   - 같은 사업명의 선정결과 파일 검색
   - 4279 (접수현황) ↔ 4305 (선정결과) 매칭 성공 ✅
   - 사업명: 한국모태펀드 중기부 소관 2024년 10월 수시 출자사업

3. **이중 파싱 (Claude Code + pdfplumber)**

   **접수현황 PDF (4279):**
   - 신청조합 수: 28개 (펀드 단위)
   - 공동GP 분리 후: 37건 (운용사 단위)
   - 출자분야: 중진 - 재기지원, 청년 - 청년창업, 혁신모험 - 창업초기

   **선정결과 PDF (4305):**
   - 선정조합 수: 4개 (펀드 단위)
   - 공동GP 분리 후: 6건 (운용사 단위)

4. **신규 운용사 유사도 검토**
   - 기존 운용사 목록과 비교
   - 정확히 일치: 28건
   - 유사도 검토 필요: 4건
     - 다성벤처스 vs 효성벤처스 (75%)
     - 제이와이피파트너스 vs 제이케이피파트너스 (80%)
     - 캡스톤파트너스 vs 에스비파트너스 (61%)
     - 나이스투자파트너스 vs 하이투자파트너스 (75%)
   - → 사용자 확인 결과: **모두 다른 회사** (신규 등록)

5. **데이터 저장**
   - 출자사업 생성: PJ0015
   - 신규 운용사: 8건 (OP0367~OP0374)
   - 신청현황: 37건 (선정 6, 탈락 31)

6. **파일 처리상태 업데이트**
   - FH0026 (4279) → 완료
   - FH0028 (4305) → 완료
   - 출자사업 현황: "총 37건 (선정 6, 탈락 31)"

### 2. 운용사 유사도 필터 개선

**사용자 피드백:**
```
신규운용사 유사도 검토할 때 '파트너스' 이런 단어가 겹쳐서 50% 이상되는거면 그건 제외하고 검토해줘.
파트너스 말고도 벤처스 이런 단어들이 겹치는 거면 그건 그럴 수 있어
```

**문제점:**
- "다성벤처스" vs "효성벤처스" → 유사도 75%
- 실제로는 완전히 다른 회사인데 "벤처스" 접미사만 같아서 유사도가 높게 나옴

**해결책:**
- `src/operator-matcher.js`에 `isSuffixOnlySimilarity()` 함수 추가
- 전체 유사도가 60~85%일 때, 핵심명(접미사 제거 후) 유사도가 60% 미만이면 자동 제외

**구현 로직:**
```javascript
function isSuffixOnlySimilarity(name1, name2, score) {
  // 85% 이상은 실제 유사한 것으로 간주
  if (score >= 0.85) return false;

  const core1 = removeCompanySuffix(normalizeName(name1));
  const core2 = removeCompanySuffix(normalizeName(name2));

  // 핵심명 유사도 계산
  const coreSimilarity = calculateSimilarity(core1, core2);

  // 핵심명 유사도가 60% 미만이면 접미사만 겹친 것으로 간주
  return coreSimilarity < 0.6;
}
```

**필터링 예시:**

| 비교 | 전체 유사도 | 핵심명 | 핵심명 유사도 | 결과 |
|------|-------------|--------|---------------|------|
| 다성벤처스 vs 효성벤처스 | 75% | "다성" vs "효성" | 50% | ✅ 자동 제외 |
| 캡스톤파트너스 vs 에스비파트너스 | 61% | "캡스톤" vs "에스비" | 33% | ✅ 자동 제외 |
| 제이와이피파트너스 vs 제이케이피파트너스 | 80% | "제이와이피" vs "제이케이피" | 80% | ⚠️ 확인 필요 |

**수정된 파일:**
- `src/operator-matcher.js` - `isSuffixOnlySimilarity()` 함수 추가, `findSimilarOperators()` 필터링 적용

### 3. 문서 구조 정리

**사용자 질문:**
```
update.md랑 claude.md랑 어떻게 나눠서 관리해야할지 모르겠네.
```

**결론:**
- `CLAUDE.md`: 프로젝트 전체 개괄 (시트 구조, 공통 규칙, 비즈니스 로직)
- `update.md`: `/update` 커맨드 상세 절차 (Step 1~6)

**수정된 파일:**
- `CLAUDE.md` - 운용사 매칭 규칙에 접미사 필터링 추가, /update 섹션 간소화
- `.claude/commands/update.md` - Step 5 (신규 운용사 유사도 검토) 추가, 필터링 규칙 문서화

### 4. 최종 결과

**처리 완료:**
| 항목 | 내용 |
|------|------|
| 출자사업 | PJ0015 - 한국모태펀드 중기부 소관 2024년 10월 수시 출자사업 |
| 접수현황 파일 | FH0026 (4279번) - 완료 |
| 선정결과 파일 | FH0028 (4305번) - 완료 |
| 신청현황 | 총 37건 (선정 6, 탈락 31) |
| 신규 운용사 | 8건 (OP0367~OP0374) |

**개선된 기능:**
- 운용사 유사도 검토 시 접미사만 겹치는 케이스 자동 필터링
- 불필요한 확인 요청 감소 → 처리 속도 향상

**배운 점:**
- 접미사(파트너스, 벤처스, 인베스트먼트)만 같으면 높은 유사도가 나올 수 있음
- 핵심명(접미사 제거 후) 유사도로 이중 체크하면 false positive 감소
- 문서는 역할에 따라 분리: 개괄(CLAUDE.md) vs 상세 절차(커맨드 파일)

---

## 2025-12-21: update.md/CLAUDE.md 정리, 글로벌리그 출자사업 처리, 영문↔한글 매칭, 운용사 병합 기능

### 1. update.md와 CLAUDE.md 중복 정리

**사용자 명령:**
```
update.md랑 claude.md 겹치는 거 확인하고 update.md가 메인으로 작동할 수 있게 수정해줘
```

**Claude Code 작업 흐름:**

1. **중복 내용 분석**
   - 두 파일 비교 → 운용사 유사도 검토 섹션이 중복됨
   - update.md Step 5와 CLAUDE.md 운용사 매칭 규칙 섹션이 거의 동일

2. **역할 분리 결정**
   - `update.md`: `/update` 명령어의 **메인 레퍼런스** (상세 프로세스)
   - `CLAUDE.md`: **공통 규칙 요약** (시트 구조, 금액 형식 등)

3. **수정 내용**
   - `update.md` 상단에 "이 문서가 `/update` 명령어의 메인 레퍼런스입니다" 추가
   - `CLAUDE.md`에서 중복된 상세 내용 제거, update.md Step 5 참조로 변경
   - `/update` 섹션에 "(메인 레퍼런스)" 표기 추가

**수정된 파일:**
- `.claude/commands/update.md` - 메인 레퍼런스 명시
- `CLAUDE.md` - 중복 제거, 참조 링크 추가

---

### 2. 부산 미래성장 벤처펀드 글로벌리그 출자사업 처리

**사용자 명령:**
```
/update 4291
```

**Claude Code 작업 흐름:**

1. **파일 쌍 찾기**
   - 파일번호 4291 조회 → FH0027 (접수현황)
   - PDF 읽어서 사업명 확인: "부산 미래성장 벤처펀드 2024년 출자사업(글로벌리그)"
   - 같은 사업의 선정결과 파일 검색 → 4316 (FH0029) 매칭 성공 ✅

2. **이중 파싱**

   **접수현황 PDF (4291) - Claude Code 분석:**
   - 신청조합 수: 2개 (펀드 단위)
   - 공동GP 분리 후: 4건 (운용사 단위)
   - 운용사: 비엔케이투자증권/MCP Asset Management, 에스케이증권/IGIS Asia

   **선정결과 PDF (4316):**
   - 선정조합 수: 1개
   - 선정 운용사: 에스케이증권/IGIS Asia

   **pdfplumber 파싱 문제:**
   - `MCP Asset Management Co., Ltd`가 `MCP Asset Management Co.`와 `Ltd`로 분리됨 ❌
   - 선정결과 PDF에서 제목이 운용사로 잘못 파싱됨 ❌
   - → Claude Code 분석 결과가 더 정확하므로 채택

3. **신규 운용사 확인**
   - 기존 운용사: 비엔케이투자증권(OP0029), 에스케이증권(OP0062)
   - 신규 운용사: MCP Asset Management Co., Ltd, IGIS Asia
   - 유사도 검사 → 유사 운용사 없음 → 신규 등록

4. **데이터 저장**
   - 출자사업 생성: PJ0016
   - 신규 운용사: OP0375 (MCP), OP0376 (IGIS)
   - 신청현황: AP0662~AP0665 (4건)
   - 파일 처리상태: FH0027, FH0029 → 완료
   - 현황: "총 4건 (선정 2, 탈락 2)"

**처리 결과:**
| 항목 | 내용 |
|------|------|
| 출자사업 | PJ0016 - 부산 미래성장 벤처펀드 2024년 출자사업(글로벌리그) |
| 신청현황 | 4건 (선정 2, 탈락 2) |
| 신규 운용사 | 2건 (MCP Asset Management, IGIS Asia) |

---

### 3. 영문↔한글 발음 양방향 매칭 기능 추가

**사용자 요청:**
```
운용사 유사도 검증할 때 비엔케이투자증권 -> BNK투자증권 이렇게 한국어발음으로 읽히는 영문도 검토해보는 걸 추가할 수 있을까?
```

**문제점:**
- 기존: 영문→한글 매칭만 지원 (KB → 케이비)
- 필요: 한글→영문 역방향 매칭도 필요 (비엔케이 → BNK)

**Claude Code 작업 흐름:**

1. **기존 코드 분석**
   - `src/operator-matcher.js`의 `ABBREV_MAP` 확인
   - 영문→한글 매핑만 존재 (kb: '케이비', nh: '엔에이치' 등)

2. **역매핑 추가**
   ```javascript
   // 한글 발음 → 영문 약어 역매핑 (자동 생성)
   const REVERSE_ABBREV_MAP = Object.fromEntries(
     Object.entries(ABBREV_MAP).map(([eng, kor]) => [kor, eng.toUpperCase()])
   );
   ```

3. **matchesAbbreviation 함수 개선**
   - 기존: 영문이면 한글과 비교, 한글이면 영문과 비교 (한 방향)
   - 개선: 양방향으로 모두 체크
   ```javascript
   // 1. 영문 → 한글 방향 체크
   for (const [eng, kor] of Object.entries(ABBREV_MAP)) {
     if (lower1.includes(eng) && lower2.includes(kor)) return true;
     if (lower2.includes(eng) && lower1.includes(kor)) return true;
   }

   // 2. 한글 → 영문 방향 체크
   for (const [kor, eng] of Object.entries(REVERSE_ABBREV_MAP)) {
     if (lower1.includes(kor) && lower2.includes(lowerEng)) return true;
     if (lower2.includes(kor) && lower1.includes(lowerEng)) return true;
   }
   ```

4. **ABBREV_MAP에 추가 약어 등록**
   - `bnk`: '비엔케이'
   - `dgb`: '디지비'
   - `jb`: '제이비'

5. **테스트 결과**
   ```
   비엔케이투자증권 vs BNK투자증권 → 85% (영문 약어 ↔ 한글 발음 매칭) ✅
   케이비증권 vs KB증권 → 85% ✅
   에스케이증권 vs SK증권 → 85% ✅
   아이비케이캐피탈 vs IBK캐피탈 → 85% ✅
   ```

**수정된 파일:**
- `src/operator-matcher.js` - REVERSE_ABBREV_MAP 추가, matchesAbbreviation 양방향 지원
- `CLAUDE.md` - "양방향" 명시 추가

---

### 4. 운용사 중복 검토 및 병합 기능 추가

**사용자 요청:**
```
이거 그럼 운용사만 새로운 기존으로 검토하는 로직이 필요할거같아.
만약에 동일인데 별도 행으로 관리되고 있다면 합쳐주는 로직도 필요할 거 같은데?
```

**Claude Code 작업 흐름:**

1. **기존 운용사 전체 중복 검사**
   - 376개 운용사 전체 쌍 비교 실행
   - 85% 이상 유사도: 34쌍 발견
   - 95% 이상 확실한 중복: 5쌍

2. **중복 유형 분류**

   **🔴 실제 중복 (병합 필요):**
   - MCP Asset Management Co., Ltd. vs MCP Asset Management Co., Ltd (98%) - 마침표 차이
   - 비엔케이벤처투자 vs BNK벤처투자 (85%) - 같은 회사
   - 신한벤처투자 vs Shinhan Ventures (85%) - 영문명

   **❌ 같은 그룹, 다른 법인 (병합 불필요):**
   - 비전벤처스 vs 비전자산운용
   - 하나벤처스 vs 하나증권
   - 케이비인베스트먼트 vs 케이비증권
   - 아이비케이벤처투자 vs 아이비케이캐피탈

   **⚠️ 오탐:**
   - 디에스엔인베스트먼트 vs Nordstar Partners (DS 매칭 오탐)
   - Shinhan Ventures vs 엔에이치투자증권 (NH가 Shinhan에 포함)

3. **병합 기능 구현**
   - `src/operator-audit.js` 생성
   - `findDuplicateOperators()` - 중복 가능성 있는 운용사 쌍 찾기
   - `mergeOperators(keepId, removeId)` - 운용사 병합 실행
   - `printDuplicateReport()` - 리포트 출력

4. **병합 로직 개선**

   **사용자 피드백:**
   ```
   병합하고 하나는 지우는 게 나을거같은데?
   ```

   - 초기: 삭제할 운용사 약어에 "→병합됨" 표시만 남김
   - 개선: 삭제할 운용사 **행 자체를 삭제**
   - `googleSheets.js`에 `deleteRow()` 함수 추가

5. **병합 실행**

   **MCP Asset Management 병합:**
   - 유지: OP0365 (마침표 있는 버전)
   - 삭제: OP0375 (마침표 없는 버전)
   - 영향: 신청현황 1건 (AP0663)

   **BNK벤처투자 병합:**
   - 유지: OP0219 (BNK벤처투자)
   - 삭제: OP0028 (비엔케이벤처투자)
   - 영향: 신청현황 3건 (AP0110, AP0170, AP0591)
   - 약어에 "비엔케이벤처투자" 추가

   **신한벤처투자 병합:**
   - 유지: OP0050 (신한벤처투자)
   - 삭제: OP0302 (Shinhan Ventures)
   - 영향: 신청현황 1건 (AP0500)
   - 약어에 "Shinhan Ventures" 추가

**생성/수정된 파일:**
- `src/operator-audit.js` - 운용사 중복 검토/병합 모듈 (신규)
- `src/googleSheets.js` - `deleteRow()` 함수 추가

**사용법:**
```bash
# 중복 리포트 (85% 이상)
node src/operator-audit.js report 0.85

# 병합 (dry run)
node src/operator-audit.js merge OP0219 OP0028

# 병합 (실행)
node src/operator-audit.js merge OP0219 OP0028 --execute
```

---

### 5. 최종 결과 요약

**처리 완료:**
| 항목 | 내용 |
|------|------|
| 출자사업 | PJ0016 - 부산 미래성장 벤처펀드 2024년 출자사업(글로벌리그) |
| 신청현황 | 4건 (선정 2, 탈락 2) |
| 운용사 병합 | 3건 (MCP, BNK, 신한) |
| 운용사 삭제 | 3건 (OP0375, OP0028, OP0302) |

**새로운 기능:**
1. 영문↔한글 발음 **양방향** 매칭 (BNK ↔ 비엔케이)
2. 기존 운용사 중복 검토 리포트
3. 운용사 병합 기능 (신청현황 자동 업데이트 + 행 삭제)

**배운 점:**
- 영문 약어와 한글 발음은 양방향으로 검사해야 중복을 놓치지 않음
- 운용사 병합 시 신청현황 운용사ID도 함께 업데이트 필요
- 같은 그룹의 계열사(증권, 벤처투자, 캐피탈)는 별도 법인이므로 병합하면 안됨

---

## 2025-12-21: 모태펀드 문화계정 2024년 12월 수시 출자사업 처리 및 자동화 모드 개선

### 1. 파일번호 4362 처리 (문화계정 수시 출자사업)

**사용자 명령:**
```
/update 4362
```

**Claude Code 작업 흐름:**

1. **파일 정보 조회**
   - 파일번호 4362 조회 → FH0030
   - 파일유형: 접수현황
   - 파일명: `모태펀드_문화계정__2024년_12월_수시_출자사업_접수_현황_게시용_최종.pdf`

2. **매칭 파일 쌍 찾기**
   - 같은 사업의 선정결과 파일 검색
   - 키워드 매칭: "문화계정", "2024년 12월 수시"
   - → 4398번 파일 발견 (선정결과) ✅

3. **출자사업 행 추가**
   - 사업명: 모태펀드 문화계정 2024년 12월 수시 출자사업
   - ID: PJ0017 (신규 생성)
   - 지원파일ID: FH0030, 결과파일ID: FH0038

4. **이중 파싱 실행**

   **Claude Code 직접 분석:**
   - 접수현황: 신청조합 10개, 공동GP 분리 후 15개 운용사
   - 선정결과: 1개 조합 선정, 공동GP 2개 운용사

   **pdfplumber 파싱:**
   - 접수현황: 15개 운용사 (일치 ✅)
   - 선정결과: 2개 운용사 + 노이즈 2건 (제목 줄 잘못 파싱)

5. **결과 비교**
   - 일치: 15건 (100%)
   - pdfplumber 노이즈: 선정결과에서 제목 줄이 잘못 파싱됨 → 무시
   - → 자동 진행

6. **유사도 검사**
   - 15개 운용사 중 14개 정확히 일치 (기존 운용사)
   - `(주)벡터기술투자` ~= `벡터기술투자` 발견
   - → 법인 표기 차이로 판단, 기존 OP0022 사용 ✅

7. **데이터 저장**
   - 신청현황 15건 생성 (AP0666 ~ AP0680)
   - 선정: 나이스투자파트너스, 트리거투자파트너스 (공동GP)
   - 탈락: 13건

**처리 결과:**
| 항목 | 값 |
|------|-----|
| 출자사업 ID | PJ0017 |
| 신청현황 | 총 15건 (선정 2, 탈락 13) |
| 신규 운용사 | 0건 (모두 기존 운용사) |
| 공동GP | 5쌍 |

---

### 2. /update 커맨드 자동화 모드 개선

**사용자 명령:**
```
앞으로 update 커맨드 실행할 때 꼭 내 의견이 필요한 것 외에는 다 강제실행모드로 할 순 없을까?
```

```
api 초과 시에도 자동으로 1분 대기하고 너가 알아서 할거니까 나한테 요청할 건 없겠다.
```

**Claude Code 작업 흐름:**

1. **기존 /update 프로세스 분석**
   - 사용자 확인 필요 케이스가 너무 많음
   - 이중 파싱 차이점, 유사 운용사, API 오류 등

2. **자동 진행 모드 설계**

   **사용자 확인이 필요한 경우 (최소화):**
   - 파일 쌍을 찾을 수 없는 경우
   - 유사도 85% 이상 + 핵심명 60% 이상 (정말 판단 불가 시)

   **자동 처리로 변경:**
   | 상황 | 자동 처리 방식 |
   |------|---------------|
   | 이중 파싱 결과 차이 | Claude Code 결과 우선 |
   | pdfplumber에만 있는 항목 | 무시 (노이즈) |
   | 유사 운용사 (85% 미만) | 신규 등록 |
   | 법인 표기 차이 | 기존 운용사와 동일 처리 |
   | API 할당량 초과 | 1분 대기 후 자동 재시도 (최대 3회) |

3. **update.md 파일 수정**
   - "실행 모드: 자동 진행 (Auto Mode)" 섹션 추가
   - Step 4: "차이점 확인" → "차이점 자동 처리"로 변경
   - Step 5: "유사도 검토" → "유사도 자동 처리"로 변경
   - API 할당량 초과 자동 재시도 규칙 추가

**수정된 파일:**
- `.claude/commands/update.md` - 자동 진행 모드 규칙 추가

**핵심 변경점:**
- 사용자 확인: 6가지 → 2가지로 축소
- API 오류 시 자동 재시도 (사용자 개입 불필요)
- Claude Code 분석 결과 우선 신뢰

---

### 3. 최종 결과 요약

**처리 완료:**
| 항목 | 내용 |
|------|------|
| 출자사업 | PJ0017 - 모태펀드 문화계정 2024년 12월 수시 출자사업 |
| 파일 처리 | 4362 (접수), 4398 (선정) → 완료 |
| 신청현황 | 15건 생성 (선정 2, 탈락 13) |

**자동화 개선:**
| 항목 | 이전 | 이후 |
|------|------|------|
| 사용자 확인 케이스 | 6가지 | 2가지 |
| API 오류 처리 | 사용자 확인 | 자동 재시도 |
| 이중 파싱 차이 | 사용자 확인 | Claude Code 우선 |

**배운 점:**
- 대부분의 확인 요청은 자동화 가능
- pdfplumber는 노이즈가 많아 Claude Code 결과를 우선 신뢰
- 법인 표기 (`(주)`, `주식회사`) 정규화로 중복 방지

---

## 2025-12-21: HWP 파일 Playwright 캡처 기능 추가 및 파일번호 4364 처리

### 1. 파일번호 4364 처리 (HWP 파일)

**사용자 명령:**
```
/update 4364
```

**Claude Code 작업 흐름:**

1. **파일 정보 조회**
   - 파일번호 4364 조회 → FH0031
   - 파일유형: 접수현황
   - 파일명: `모태펀드_보건계정__2024년_12월_수시_출자사업_접수_현황.hwp`
   - → **HWP 파일!** Read 도구로 직접 읽을 수 없음 ❌

2. **Playwright MCP로 Google Drive 뷰어 활용**
   - Google Drive URL: `https://drive.google.com/file/d/12J6qXKmNjkHlgSNTNeiUk3sgifY1zHGL/view`
   - `browser_navigate` → Google Drive 뷰어에서 HWP 열기
   - `browser_wait_for` → 2초 대기 (렌더링)
   - `browser_snapshot` → 페이지 정보 확인 (1/1 페이지)
   - `browser_take_screenshot` → 스크린샷 캡처
   - `Read` → 캡처 이미지 OCR 분석 ✅

3. **HWP 내용 분석 결과**
   - **사업명**: 모태펀드(보건계정) 2024년 12월 수시 출자사업
   - **신청조합 수**: 3개 (공동GP 3쌍)
   - **결성예정액**: 3,000억 원
   - **출자요청액**: 450억 원

   | 출자분야 | 운용사명 (공동GP) |
   |---------|-----------------|
   | 바이오헬스 | 데일리파트너스, NH투자증권 |
   | 바이오헬스 | NBH캐피탈, 리네아인베스트먼트 |
   | 바이오헬스 | 젤코바인베스트먼트, 모하비인베스트먼트 |

4. **매칭 파일 쌍 찾기**
   - 같은 사업의 선정결과 파일 검색
   - → 4388번 파일 발견 (선정결과, PDF) ✅
   - 4388 파일 처리상태: 이미 완료
   - → 출자사업 PJ0018에 이미 2건 등록되어 있음

5. **기존 데이터 분석**
   - 출자사업 PJ0018: 모태펀드(보건계정) 2024년 12월 수시 출자사업
   - 기존 신청현황: 2건 (선정된 조합만 등록됨)
     - AP0681: 데일리파트너스 (선정)
     - AP0682: NH투자증권 (선정)
   - → **탈락한 4개 운용사 누락!**

6. **누락된 운용사 등록**
   - NBH캐피탈: 기존 존재 (OP0144)
   - 리네아인베스트먼트: 신규 등록 → OP0378
   - 젤코바인베스트먼트: 신규 등록 → OP0379
   - 모하비인베스트먼트: 신규 등록 → OP0380

7. **탈락 신청현황 추가**
   - AP0683: NBH캐피탈 (탈락, 공동GP)
   - AP0684: 리네아인베스트먼트 (탈락, 공동GP)
   - AP0685: 젤코바인베스트먼트 (탈락, 공동GP)
   - AP0686: 모하비인베스트먼트 (탈락, 공동GP)

8. **출자사업 현황 업데이트**
   - PJ0018: 총 6건 (선정 2, 탈락 4) ✅

**처리 결과:**
| 항목 | 값 |
|------|-----|
| 출자사업 ID | PJ0018 |
| 신청현황 | 총 6건 (선정 2, 탈락 4) |
| 신규 운용사 | 3건 (OP0378~OP0380) |
| 신규 신청현황 | 4건 (AP0683~AP0686) |

---

### 2. Playwright MCP 여러 페이지 캡처 기능 구현

**사용자 명령:**
```
만약 페이지가 여러 장이면 스크롤해서 캡처하는 것도 하니?
```
```
응
```

**Claude Code 작업 흐름:**

1. **여러 페이지 HWP 파일 탐색**
   - 4408번: 특허 2024년 11월 수시 → 1/1 페이지 (단일)
   - 4636번: 특허계정 2025년 10월 수시 → 1/1 페이지 (단일)
   - → HWP는 대부분 단일 페이지

2. **여러 페이지 PDF 파일로 테스트**
   - 4116번: 한국모태펀드 중기부 2024년 1차 정시 선정 결과
   - Google Drive에서 열기 → **1/2 페이지** 확인 ✅

3. **PageDown 키로 페이지 이동 테스트**
   - 1페이지에서 `browser_take_screenshot` → 캡처 성공
   - `browser_press_key` → "PageDown" 누르기
   - → 페이지 표시가 **2/2**로 변경됨 ✅
   - 2페이지에서 `browser_take_screenshot` → 캡처 성공

4. **문제 발견: 페이지 하단 짤림**
   - 100% 줌에서 페이지 하단이 화면에 안 들어옴
   - 2페이지 캡처 이미지에서 하단 내용 짤림 확인 ❌

5. **해결책 1: 줌 축소 테스트**
   - 축소 버튼 클릭 → 100% → 75% → 50%
   - 50% 줌에서 두 페이지가 모두 한 화면에 표시됨 ✅
   - **단점**: 글씨가 너무 작아서 OCR 정확도 저하 우려

6. **해결책 2: 페이지 내 스크롤 테스트**
   - 75% 줌에서 `ArrowDown` 키로 점진적 스크롤
   - 상단 캡처 → ArrowDown 3~4회 → 하단 캡처
   - → 짤리는 부분 없이 완전한 캡처 가능 ✅

7. **50% 줌 OCR 테스트**
   - 50% 줌 캡처 이미지를 Read 도구로 분석
   - 결과: 대략적인 내용은 읽히지만 일부 글씨 흐릿
   - → **75% + ArrowDown 스크롤이 더 안전**

**테스트 결과 요약:**

| 방법 | 줌 | 키 | 캡처 횟수/페이지 | 정확도 |
|------|-----|-----|----------------|--------|
| 단순 페이지 이동 | 100% | PageDown | 1회 | 하단 짤림 ❌ |
| 줌 축소 | 50% | PageDown | 1회 | 글씨 흐릿 △ |
| **권장** | 75% | ArrowDown + PageDown | 2회 | 완전 ✅ |

---

### 3. update.md 및 유틸리티 파일 업데이트

**수정/생성된 파일:**

1. **`.claude/commands/update.md`**
   - 지원 파일 형식 섹션 추가 (PDF, HWP)
   - Step 3: PDF/HWP 분기 처리 로직 추가
   - HWP 캡처 프로세스 상세 문서화
   - 여러 페이지 캡처 가이드 추가
   - 줌 레벨별 특징, 네비게이션 키 테이블 추가
   - 프로세스 요약 다이어그램 업데이트

2. **`src/gdrive-capture.js`** (신규 생성)
   - Google Drive 문서 캡처 유틸리티 모듈
   - `parsePageInfo()`: 스냅샷에서 페이지 정보 파싱
   - `NAVIGATION_METHODS`: 네비게이션 키 상수
   - `getCaptureGuide()`: 단계별 캡처 가이드
   - `generateFilename()`: 캡처 파일명 생성
   - `detectViewerType()`: 뷰어 타입 감지
   - `getNavigationKey()`: 뷰어별 권장 네비게이션 키

**핵심 변경점:**
- HWP 파일도 `/update` 명령어로 처리 가능
- Playwright MCP를 활용한 Google Drive 뷰어 캡처
- 여러 페이지 문서 순차 캡처 지원
- 75% 줌 + ArrowDown 스크롤로 완전한 캡처 보장

---

### 4. 최종 결과 요약

**파일 처리:**
| 항목 | 내용 |
|------|------|
| 파일번호 | 4364 (HWP) |
| 출자사업 | PJ0018 - 모태펀드(보건계정) 2024년 12월 수시 출자사업 |
| 신청현황 | 6건 (선정 2, 탈락 4) |
| 신규 운용사 | 3건 |

**기능 추가:**
| 기능 | 설명 |
|------|------|
| HWP 파일 지원 | Playwright MCP + Google Drive 뷰어 |
| 여러 페이지 캡처 | PageDown + ArrowDown 조합 |
| 캡처 유틸리티 | `src/gdrive-capture.js` |

**배운 점:**
- HWP 파일은 Read 도구로 직접 못 읽지만 Google Drive 뷰어로 해결
- Playwright MCP의 `browser_snapshot`에서 페이지 정보 파싱 가능
- 50% 줌은 OCR 정확도가 떨어져서 75% + 스크롤 권장
- ArrowDown은 페이지 내 스크롤, PageDown은 페이지 이동


---

## 2025-12-21: PJ0017 결과파일ID 오류 수정 및 파일 시트 현황 컬럼 구현

### 1. PJ0017 결과파일ID 중복 연결 오류 수정

**사용자 명령:**
```
출자사업 PJ0017의 경우 왜 결과파일이 2개야?
```

**Claude Code 작업 흐름:**

1. **문제 파악**
   - PJ0017(모태펀드 문화계정 2024년 12월 수시) 조회
   - 결과파일ID: `FH0028, FH0038` 두 개가 연결됨
   - FH0028: 중기부 10월 수시 선정결과 (잘못된 파일)
   - FH0038: 문체부 12월 수시 선정결과 (올바른 파일)

2. **원인 분석**
   - FH0028은 PJ0015(중기부 10월 수시)에 이미 연결되어 있음
   - 이전 처리 과정에서 PJ0017에 잘못 중복 연결됨

3. **수정 작업**
   - PJ0017의 결과파일ID를 `FH0038`만 남기도록 수정
   - 출자사업\!H18 셀 직접 업데이트

4. **사이드이펙트 검토**
   - FH0028이 PJ0015에만 연결되어 있는지 확인 → ✅
   - PJ0015 신청현황: 37건 (선정 6, 탈락 31) - 정상 ✅
   - PJ0017 신청현황: 15건 (선정 2, 탈락 13) - 정상 ✅

5. **재발 방지 지침 추가**
   - CLAUDE.md에 "출자사업-파일 연결 검증" 섹션 추가
   - 파일명-사업명 일치 확인 체크리스트 추가

**수정된 파일:**
- `CLAUDE.md` - 출자사업-파일 연결 검증 규칙 추가

---

### 2. 파일 시트 현황 컬럼 자동 업데이트 기능 구현

**사용자 명령:**
```
ultrathink 각 파일마다 현황 행에 지원현황이면 -> 신청 조합 N개, 공동 지원 N개(여기에는 2개조합 몇 건 3개조합 몇 건.. 이런 개 표기되고), 총 신청현황 N개 -- 이런 정보 표기가 필요해. 선발결과면 총 N개 신청현황 선정- 이렇게. 계획을 세워줘
```

**Claude Code 작업 흐름:**

1. **요구사항 분석**
   - 파일 시트에 새로운 현황(I열) 컬럼 추가됨 (사용자가 직접 추가)
   - 접수현황 파일: `신청조합 N개, 공동GP N개(2개조합 N건, 3개조합 N건), 총 신청현황 N건`
   - 선정결과 파일: `총 N개 중 선정 N건`

2. **계획 수립**
   - Plan mode로 구현 계획 작성
   - 필요한 파일 및 수정 사항 정리

3. **구현 작업**

   **3-1. googleSheets.js 수정**
   - `updateFileHistory()` 메서드에 현황 필드(I열) 업데이트 추가
   - 열 순서 주석 업데이트

   **3-2. file-summary.js 신규 생성**
   - `splitJointGPWithStats()`: 공동GP 분리 및 통계 수집
   - `createApplicationStats()`: 접수현황 통계 객체 초기화
   - `createSelectionStats()`: 선정결과 통계 객체 초기화
   - `formatApplicationFileSummary()`: 접수현황 현황 문자열 생성
   - `formatSelectionFileSummary()`: 선정결과 현황 문자열 생성

   **3-3. setup-sheets.js 수정**
   - 파일 시트 헤더에 현황 컬럼 추가

   **3-4. update.md 수정**
   - Step 6에 파일 현황 업데이트 절차 추가
   - 파일 현황 통계 수집 섹션 추가

   **3-5. CLAUDE.md 수정**
   - 파일 시트 구조에 현황 컬럼 추가
   - 파일 시트 현황 필드 형식 섹션 추가

**생성/수정된 파일:**

| 파일 | 작업 |
|------|------|
| `src/googleSheets.js` | updateFileHistory()에 현황 필드 지원 추가 |
| `src/file-summary.js` | **신규 생성** - 통계 수집 및 현황 문자열 생성 함수 |
| `src/setup-sheets.js` | 파일 시트 헤더에 현황 컬럼 추가 |
| `.claude/commands/update.md` | Step 6에 파일 현황 업데이트 절차 추가 |
| `CLAUDE.md` | 파일 시트 구조 및 현황 형식 문서화 |

**현황 표기 형식 예시:**

| 파일유형 | 현황 형식 |
|----------|----------|
| 접수현황 | `신청조합 149개, 공동GP 12개(2개조합 10건, 3개조합 2건), 총 신청현황 165건` |
| 선정결과 | `총 165개 중 선정 43건` |

**통계 수집 데이터 구조:**
```javascript
// 접수현황 파일용
const appStats = {
  originalCount: 0,       // PDF 원본 조합 수 (분리 전)
  jointGPGroups: {},      // { 2: 10, 3: 2 } - N개조합별 건수
  totalJointGPCount: 0,   // 공동GP 포함 조합 총 수
  finalCount: 0           // 분리 후 최종 신청현황 수
};

// 선정결과 파일용
const selStats = {
  totalInPdf: 0,          // PDF 기재 총 건수
  selectedCount: 0        // 선정 건수
};
```

**배운 점:**
- 파일 시트에 처리 결과 요약을 저장하면 한눈에 파악 가능
- 공동GP 분리 시 통계를 함께 수집하면 현황 생성 용이
- 파일유형에 따라 다른 형식의 현황 문자열 필요

---

## 2025-12-21: /update 4383 처리 및 단계별 프로세스 수정

### 1. 파일번호 4383 처리 (모태펀드 문화/영화/특허 2025년 1차 정시)

**사용자 명령:**
```
/update 4383
```

**Claude Code 작업 흐름:**

1. **파일 정보 조회**
   - Google Sheets 파일 시트에서 4383 조회
   - → FH0033: 접수현황 파일 확인 ✅
   - 파일명: `4383_붙임._모태펀드_문화__영화__특허__2025년_1차_정시_출자사업_신청_현황_게시용_최종.pdf`

2. **파일 쌍 찾기**
   - 같은 사업의 선정결과 파일 검색
   - → FH0044: `4444_붙임._모태펀드_문화_영화_특허__2025년_1차_정시_출자사업_선정_결과_게시용_최종.pdf` 발견 ✅

3. **PDF 이중 파싱**
   - **접수현황 PDF (Claude 직접 분석)**
     - 신청조합 56개, 결성예정액 2조 621.5억원
     - 출자분야: IP, 문화일반, 수출, 신기술, 콘텐츠 육성, 애니메이션 전문, 중저예산한국영화, 한국영화 메인투자, IP직접투자
   - **pdfplumber 파싱** → 69건 추출 (공동GP 분리 후)
   
   - **선정결과 PDF (Claude 직접 분석)**
     - 최종 선정 조합 12개
     - 선정 운용사 15건 (공동GP 분리 후)
   - **pdfplumber 파싱** → 노이즈 포함 (제목이 분리됨)

4. **이중 파싱 결과 비교**
   - 일치: 15건 (유효 선정 운용사)
   - pdfplumber 노이즈 제외: 4건 (제목 분리된 항목)
   - → Claude Code 결과 우선 적용

5. **출자사업 생성**
   - `sheets.getOrCreateProject()` 호출
   - → **PJ0021** 생성: 모태펀드(문화, 영화, 특허) 2025년 1차 정시
   - 소관: 문체부/특허청

6. **운용사 매칭 및 신규 등록**
   - 기존 운용사 매칭: 33개
   - 신규 운용사 생성: 9개
     - OP0385: 디에이밸류인베스트먼트
     - OP0386: 지앤피인베스트먼트
     - OP0387: 에이티유파트너스
     - OP0388: 지온인베스트먼트
     - OP0389: 라구나인베스트먼트
     - OP0390: 와프인베스트먼트
     - OP0391: 캐피탈원
     - OP0392: 아이디어브릿지자산운용
     - OP0393: 카스피안캐피탈

7. **신청현황 저장 (⚠️ 잘못된 방식)**
   - 접수현황+선정결과를 **동시에 보고 바로 선정/탈락 판단**
   - 69건 저장: 선정 15, 탈락 54
   - → 결과는 맞지만 **프로세스가 잘못됨**

8. **파일 및 출자사업 현황 업데이트**
   - FH0033: 처리상태 `완료`, 현황 `신청조합 56개, 공동GP 13개(2개조합 13건), 총 신청현황 69건`
   - FH0044: 처리상태 `완료`, 현황 `총 56개 중 선정 12건`
   - PJ0021: 현황 `총 69건 (선정 15, 탈락 54)`

**처리 결과:**

| 항목 | 값 |
|------|-----|
| 출자사업 ID | PJ0021 |
| 총 신청현황 | 69건 |
| 선정 | 15건 |
| 탈락 | 54건 |
| 신규 운용사 | 9개 |

---

### 2. 단계별 프로세스 수정 요청

**사용자 명령:**
```
지원현황 파일 보고 신청현황을 먼저 지원 상태로 쌓은 후에, 결과파일 보고 탈락/선정 업데이트 하기로 하지 않았나?
```

**Claude Code 작업 흐름:**

1. **문제 인식**
   - 현재 로직: 두 파일 동시에 보고 바로 선정/탈락 판단 ❌
   - 올바른 로직:
     1. 접수현황 파일 → 모든 신청현황을 **"접수"** 상태로 저장
     2. 선정결과 파일 → 선정된 운용사는 **"선정"**, 나머지는 **"탈락"**으로 업데이트

2. **update.md 수정 (1차)**
   - 핵심 원칙 추가: "접수현황과 선정결과는 반드시 순차적으로 처리"
   - Step 5를 파일유형별 분기 처리로 변경
   - → **파일 쌍 찾기 로직 제거됨** ❌

3. **사용자 피드백**
   ```
   파일 쌍 찾기를 왜 제거해? 반대유형도 찾아야 처리를 하지
   ```
   - 파일 쌍 찾기가 필요한 이유:
     - 어떤 출자사업인지 확인
     - 선정결과 입력 시 접수현황이 먼저 처리되었는지 확인

4. **update.md 수정 (2차)**
   - Step 1에 파일 쌍 찾기 로직 복원 ✅
   - 쌍 파일 상태 확인 로직 추가:
     - 접수현황 입력 시: 선정결과 파일이 있으면 함께 처리 예정
     - 선정결과 입력 시: 접수현황이 미처리면 **접수현황 먼저 처리**

**수정된 update.md 핵심 내용:**

```markdown
## 핵심 원칙: 단계별 처리

1. **접수현황 파일 처리** → 모든 신청현황을 **"접수"** 상태로 저장
2. **선정결과 파일 처리** → 선정된 운용사는 **"선정"**, 나머지는 **"탈락"**으로 업데이트

> ⚠️ 두 파일을 동시에 보고 바로 선정/탈락을 판단하면 안 됩니다.
```

**배운 점:**
- 데이터 처리는 단계별로 해야 추적 가능
- 접수현황만 있고 선정결과가 아직 없는 경우도 처리 가능해야 함
- 결과가 맞더라도 프로세스가 잘못되면 나중에 문제 발생

**수정된 파일:**
- `.claude/commands/update.md` - 단계별 처리 프로세스로 전면 수정
