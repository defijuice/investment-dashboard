# Google Sheets 스키마

이 문서는 Google Sheets의 데이터 구조와 필드 형식을 정의합니다.

## 스프레드시트 (4시트)

| 시트 | ID 프리픽스 | 컬럼 |
|------|-------------|------|
| 운용사 | OP | ID, 운용사명, 약어, 유형, 국가 |
| 출자사업 | PJ | ID, 사업명, 소관, 공고유형, 연도, 차수, 지원파일ID, 결과파일ID, 현황 |
| 신청현황 | AP | ID, 출자사업ID, 운용사ID, 출자분야, 최소결성규모, 모태출자액, 결성예정액, 출자요청액, 통화단위, 상태, 비고 |
| 파일 | FH | ID, 파일명, 파일번호, 파일유형, 파일URL, 처리상태, 처리일시, 비고, **현황** |

## 파일처리이력

- `processed.json`에서 로컬 관리

## 파일 시트 현황 필드 형식

파일 처리 완료 시 현황(I열)에 통계 정보 저장:

### 접수현황 파일

```text
신청조합 N개, 공동GP N개(2개조합 N건, 3개조합 N건), 총 신청현황 N건
```

예: `신청조합 149개, 공동GP 12개(2개조합 10건, 3개조합 2건), 총 신청현황 165건`

### 선정결과 파일

```text
총 N개 중 선정 N건
```

예: `총 165개 중 선정 43건`

**관련 파일**: [src/file-summary.js](../src/file-summary.js)

## ⚠️ 파일 현황 동기화 규칙 (CRITICAL)

**파일 현황은 반드시 신청현황 테이블에서 계산해야 한다.**

### 절대 금지

- 파싱 결과 건수를 직접 현황에 저장하지 말 것
- PDF에 표기된 "N개" 숫자를 그대로 사용하지 말 것

### 이유

- 중복 스킵, 공동GP 분리 등으로 파싱 결과와 실제 저장 건수가 다를 수 있음
- 예: PDF에 19개 표기 → 1건 중복 스킵 → 실제 18건 저장 시, 현황도 18개여야 함

### 올바른 방법

```javascript
// 선정결과 파일 처리 완료 후
await sheets.syncFileStatusWithApplications(fileId);
// → 연결된 출자사업의 신청현황에서 총 건수, 선정 건수 계산하여 저장
```

**관련 함수**: `GoogleSheetsClient.syncFileStatusWithApplications()`

## 출자사업 현황 필드

신청현황 통계를 자동 집계하여 표시:

- 형식: `총 171건 (선정 45, 탈락 126)`
- PDF 처리 완료 시 자동 업데이트
- 수동 업데이트: `sheets.updateProjectStatus('PJ0001')` 또는 `sheets.updateAllProjectStatuses()`
